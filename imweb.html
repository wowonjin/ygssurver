<!-- 아임웹 코드박스용: 신청서 + 버튼 (폰트 크게 & 레이아웃 재배치) -->
<link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
<style>
  .consult-form{
    --line:#e6eeea;--ink:#0e1b14;--brand:#2f7a57;--focus:0 0 0 3px rgba(47,122,87,.18);
    font-family:"Pretendard Variable",Pretendard,-apple-system,BlinkMacSystemFont,"Segoe UI","Apple SD Gothic Neo","Noto Sans KR",Roboto,Helvetica,Arial,sans-serif;
    color:var(--ink);font-size:20px
  }
  .consult-form .grid{display:grid;grid-template-columns:1fr;gap:18px}
  @media(min-width:840px){.consult-form .grid{grid-template-columns:1fr 1fr}}
  .consult-form .field{display:flex;flex-direction:column;gap:10px;text-align:left}
  .consult-form .label{font-weight:800;font-size:20px;text-align:left}
  .consult-form .input,.consult-form .select,.consult-form .textarea{
    width:100%;padding:16px 16px;border:1px solid var(--line);border-radius:12px;
    outline:none;background:#fff;font-size:18px;
    -webkit-appearance:none;-moz-appearance:none;appearance:none
  }
  .consult-form .input:focus,.consult-form .select:focus,.consult-form .textarea:focus{border-color:#5377f6;border-width:1px}
  
  /* 드롭다운 select 요소 강제 스타일 */
  .consult-form .select{
    border-color:var(--line)!important;
    outline:none!important;
    box-shadow:none!important;
  }
  .consult-form .select:focus,.consult-form .select:active,.consult-form .select:hover{
    border-color:#5377f6!important;
    border-width:1px!important;
    outline:none!important;
    box-shadow:none!important;
  }

  /* 드롭다운 옵션 스타일 */
  .consult-form .select option{
    padding:12px 16px;background:#fff;color:var(--ink);font-size:18px;
    border:none;cursor:pointer;transition:background-color 0.2s ease
  }
  .consult-form .select option:hover,.consult-form .select option:focus{
    background:#f0f4ff;color:#5377f6
  }
  .consult-form .select option:checked{
    background:#f0f4ff;color:#5377f6;font-weight:600
  }
  .consult-form .select optgroup{
    font-weight:700;font-size:17px;color:#5377f6;padding:8px 0 4px 0;
    background:#f8f9fa;border-bottom:1px solid #5377f6;margin-top:8px
  }
  
  /* 드롭다운 목록 박스 외곽선 - 브라우저별 스타일 */
  .consult-form .select::-ms-expand{
    border:1px solid #5377f6;
  }
  .consult-form .select:focus::-ms-expand{
    border-color:#5377f6;
  }
  .consult-form .select optgroup:first-child{
    margin-top:0
  }
  .consult-form .select optgroup option{
    padding-left:24px;font-weight:400;color:var(--ink)
  }
  .consult-form .select optgroup option:hover{
    background:#f0f4ff;color:#5377f6
  }

  /* 버튼 색상: #5377f6 */
  .consult-form .btn{
    appearance:none;border:none;border-radius:999px;padding:18px 22px;
    font-weight:800;letter-spacing:.02em;font-size:20px;cursor:pointer;
    background:#5377f6!important;color:#fff!important;min-width:240px;transition:transform .02s ease
  }
  /* 살짝 눌리는 느낌만 유지(테두리 효과 제거 유지) */
  .consult-form .btn:active{transform:translateY(1px);outline:none;box-shadow:none;background:#5377f6!important}
  .consult-form .btn:hover{filter:none;background:#5377f6!important}
  .consult-form .btn:focus{outline:none;box-shadow:none;background:#5377f6!important}

  /* "눌리지 않을 때"(= 비활성/disabled) 회색 톤으로 살짝 어둡게 */
  .consult-form .btn[disabled]{
    cursor:not-allowed;
    /* 배경과 글자 모두 살짝 회색/어둡게 */
    filter:grayscale(35%) brightness(0.92);
    background:#5377f6!important;
  }

  .consult-form .divider{grid-column:1/-1;height:1px;background:var(--line);margin:8px 0}
  .consult-form .agree{display:flex;align-items:flex-start;gap:12px;position:relative}
  .consult-form .agree label{font-size:18px;cursor:pointer}
  .consult-form .agree input[type="checkbox"]{width:20px;height:20px;cursor:pointer}
  .consult-form .hint{color:#6c7a71;font-size:16px}
  .consult-form .textarea{font-size:16px;line-height:1.6;min-height:100px}
  .reveal-on-scroll{
    opacity:0;
    transform:translate3d(0,28px,0);
    transition:opacity .7s cubic-bezier(.22,1,.36,1),transform .7s cubic-bezier(.22,1,.36,1);
    transition-delay:0s;
    will-change:opacity,transform
  }

  @media(max-width:640px){
    .consult-form{
      font-size:15px;
      padding:0 4px;
    }
    .consult-form .grid{
      gap:12px;
    }
    .consult-form .label{
      font-size:16px;
    }
    .consult-form .input,
    .consult-form .select,
    .consult-form .textarea{
      font-size:14px;
      padding:12px 12px;
    }
    .consult-form .hint{
      font-size:12px;
    }
    .consult-form .btn{
      width:100%;
      min-width:auto;
      font-size:16px;
      padding:14px 16px;
    }
    .consult-form .textarea{
      min-height:80px;
    }
  }
  .reveal-on-scroll.is-visible{
    opacity:1;
    transform:translate3d(0,0,0)
  }
  @media(prefers-reduced-motion:reduce){
    .reveal-on-scroll{
      opacity:1!important;
      transform:none!important;
      transition:none!important
    }
  }
  
  /* 필드 말풍선 스타일 */
  .consult-form .field{position:relative}
  .consult-form .field-tooltip{
    position:absolute;bottom:100%;left:0;margin-bottom:8px;
    background:#333;color:#fff;padding:10px 14px;border-radius:8px;
    font-size:15px;white-space:nowrap;z-index:1000;
    opacity:0;visibility:hidden;transition:opacity 0.2s,visibility 0.2s;
    pointer-events:none;box-shadow:0 2px 8px rgba(0,0,0,0.15)
  }
  .consult-form .field-tooltip::after{
    content:'';position:absolute;top:100%;left:20px;
    border:6px solid transparent;border-top-color:#333
  }
  .consult-form .field-tooltip.show{
    opacity:1;visibility:visible
  }
  .consult-form .agree .field-tooltip{
    bottom:auto;top:100%;left:0;margin-top:8px
  }
  .consult-form .agree .field-tooltip::after{
    top:auto;bottom:100%;border-top-color:transparent;border-bottom-color:#333
  }
</style>

<div class="consult-form">
  <!-- action 속성을 배포된 백엔드 주소로 맞춰주세요. 아래 기본값은 Render 예시입니다. -->
  <form id="contactForm" action="https://ygsa-backend.onrender.com/api/consult" method="POST" novalidate>
    <div class="grid">
      <!-- 성명 -->
      <div class="field">
        <label for="name" class="label">성명</label>
        <input id="name" name="name" class="input" type="text" placeholder="홍길동" required autocomplete="name" />
        <div class="field-tooltip" data-field="name">성명을 입력해주세요.</div>
      </div>

      <!-- 성별: 드롭다운 -->
      <div class="field">
        <label for="gender" class="label">성별</label>
        <select id="gender" name="gender" class="select" required>
          <option value="" selected disabled>(선택)</option>
          <option value="남">남자</option>
          <option value="여">여자</option>
        </select>
        <div class="field-tooltip" data-field="gender">성별을 선택해주세요.</div>
      </div>

      <!-- 연락처 (왼쪽) -->
      <div class="field">
        <label for="phone" class="label">연락처</label>
        <input id="phone" name="phone" class="input" type="tel" inputmode="tel" placeholder="010-1234-5678" required autocomplete="tel-national" />
        <div class="hint">숫자만 입력하면 자동으로 하이픈(-)이 삽입됩니다.</div>
        <div class="field-tooltip" data-field="phone">연락처를 입력해주세요.</div>
      </div>

      <!-- 생년 (연락처 오른쪽) -->
      <div class="field">
        <label for="birth" class="label">생년</label>
        <input
          id="birth"
          name="birth"
          class="input"
          type="text"
          inputmode="numeric"
          maxlength="6"
          placeholder="1998년"
          required
          autocomplete="bday-year"
        />
        <div class="field-tooltip" data-field="birth">예) 1998년</div>
      </div>

      <!-- 최종학력 -->
      <div class="field">
        <label for="edu" class="label">최종학력</label>
        <select id="edu" name="education" class="select" required>
          <option value="" selected disabled>(선택)</option>
          <optgroup label="고등교육 이전">
            <option>고등학교 재학</option>
            <option>고등학교 졸업(검정고시 포함)</option>
          </optgroup>
          <optgroup label="전문대(2·3년)">
            <option>전문대 재학</option>
            <option>전문학사 졸업</option>
          </optgroup>
          <optgroup label="대학교(4년)">
            <option>대학교 재학(4년)</option>
            <option>학사 졸업</option>
          </optgroup>
          <optgroup label="대학원">
            <option>석사 과정 재학</option>
            <option>석사 졸업</option>
            <option>박사 과정 재학</option>
            <option>박사 졸업</option>
          </optgroup>
          <optgroup label="기타">
            <option>해외 대학 재학/졸업</option>
            <option>기타</option>
          </optgroup>
        </select>
        <div class="field-tooltip" data-field="edu">최종학력을 선택해주세요.</div>
      </div>

      <!-- 직업 -->
      <div class="field">
        <label for="job" class="label">직업</label>
        <input id="job" name="job" class="input" type="text" placeholder="삼성전자" autocomplete="organization" required />
        <div class="field-tooltip" data-field="job">현재 직업 또는 근무처를 입력해주세요.</div>
      </div>

      <!-- 거주지역 -->
      <div class="field">
        <label for="region" class="label">거주지역</label>
        <select id="region" name="region" class="select" required>
          <option value="" selected disabled>(선택)</option>
          <option>서울</option><option>경기</option><option>인천</option>
          <option>부산</option><option>대구</option><option>광주</option>
          <option>대전</option><option>울산</option><option>세종</option>
          <option>강원</option><option>충북</option><option>충남</option>
          <option>전북</option><option>전남</option><option>경북</option>
          <option>경남</option><option>제주</option>
        </select>
        <div class="field-tooltip" data-field="region">거주지역을 선택해주세요.</div>
      </div>

      <!-- 거주 구 -->
      <div class="field">
        <label for="district" class="label">거주 구</label>
        <input id="district" name="district" class="input" type="text" placeholder="강남구" required />
        <div class="field-tooltip" data-field="district">거주하시는 구/군을 입력해주세요.</div>
      </div>

      <!-- 개인정보 동의 (회사명: 투미프롬) -->
      <div class="field" style="grid-column:1/-1">
        <label class="label">개인정보 수집 및 이용 동의</label>
        <textarea class="textarea" readonly>
본 투미프롬 주식회사(이하 "회사")는 이용자의 동의를 기반으로 개인정보를 수집·이용합니다. 수집 목적: 서비스 제공 및 상담, 본인 확인, 고객 문의 응대 등. 보유·이용 기간: 목적 달성 시까지 또는 관련 법령에 따른 기간. 동의를 거부할 권리가 있으나, 동의하지 않을 경우 상담 신청이 제한될 수 있습니다.
        </textarea>
        <div class="agree">
          <input type="checkbox" id="agree" required />
          <label for="agree">개인정보 수집 및 이용에 동의합니다.</label>
          <div class="field-tooltip" data-field="agree">개인정보 수집 및 이용에 동의해주세요.</div>
        </div>
      </div>

      <div class="divider" aria-hidden="true"></div>

      <!-- 제출 버튼 -->
      <div style="grid-column:1/-1;display:flex;justify-content:center">
        <button id="submitBtn" class="btn" type="submit" disabled>무료 상담 신청하기</button>
      </div>
    </div>
  </form>
</div>

<script>
(function(){
  // 스크롤 진입 시 요소 애니메이션
  const revealTargets = Array.from(document.querySelectorAll('.consult-form, .consult-form .grid > *, .consult-form .divider, .consult-form .btn'));
  if (revealTargets.length) {
    if ('IntersectionObserver' in window) {
      const revealObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('is-visible');
            observer.unobserve(entry.target);
          }
        });
      }, {
        threshold: 0.2,
        rootMargin: '0px 0px -10% 0px'
      });

      revealTargets.forEach((el) => {
        el.classList.add('reveal-on-scroll');
        el.style.setProperty('--reveal-delay', '0ms');
        revealObserver.observe(el);
      });
    } else {
      revealTargets.forEach(el => {
        el.classList.add('reveal-on-scroll', 'is-visible');
      });
    }
  }

  // 엘리먼트 참조
  const form = document.getElementById('contactForm');
  if(!form) return;

  const phoneEl   = form.querySelector('#phone');
  const agree     = form.querySelector('#agree');
  const submitBtn = form.querySelector('#submitBtn');
  const birthEl   = form.querySelector('#birth');

  // 생년 입력 안내 (숫자와 '년'만 허용)
  if (birthEl) {
    birthEl.addEventListener('input', () => {
      birthEl.value = birthEl.value.replace(/[^0-9년]/g, '');
    });
  }

  // 연락처 자동 하이픈(숫자만 입력 허용)
  if (phoneEl) {
    phoneEl.addEventListener('input', ()=>{
      let v = phoneEl.value.replace(/[^0-9]/g, '');
      if (v.length < 4) { phoneEl.value = v; return; }
      if (v.length < 8) { phoneEl.value = v.replace(/(\d{3})(\d+)/, '$1-$2'); return; }
      phoneEl.value = v.replace(/(\d{3})(\d{3,4})(\d{0,4}).*/, '$1-$2-$3');
    });
  }

  // 드롭다운 외곽선 색상 강제 적용
  const selects = form.querySelectorAll('.select');
  selects.forEach(select => {
    select.addEventListener('mousedown', function() {
      this.style.borderColor = '#5377f6';
      this.style.borderWidth = '1px';
    });
    select.addEventListener('focus', function() {
      this.style.borderColor = '#5377f6';
      this.style.borderWidth = '1px';
    });
    select.addEventListener('blur', function() {
      this.style.borderColor = 'var(--line)';
    });
  });

  // 말풍선 표시/숨김 함수
  const showTooltip = (fieldName, message) => {
    const tooltip = form.querySelector(`[data-field="${fieldName}"]`);
    if (tooltip) {
      tooltip.textContent = message || tooltip.textContent;
      tooltip.classList.add('show');
    }
  };
  
  const hideTooltip = (fieldName) => {
    const tooltip = form.querySelector(`[data-field="${fieldName}"]`);
    if (tooltip) {
      tooltip.classList.remove('show');
    }
  };
  
  // 모든 필드에 대한 입력/변경 이벤트 리스너 추가
  const setupFieldValidation = () => {
    const requiredFields = form.querySelectorAll('[required]');
    requiredFields.forEach(field => {
      const fieldName = field.id || field.name;
      
      // 입력/선택 시 말풍선 숨김
      const hideHandler = () => {
        if (field.type === 'checkbox') {
          if (field.checked) hideTooltip(fieldName);
        } else if (field.tagName === 'SELECT') {
          if (field.value && field.value !== '') hideTooltip(fieldName);
        } else {
          if (field.value && field.value.trim() !== '') hideTooltip(fieldName);
        }
      };
      
      if (field.tagName === 'SELECT' || field.type === 'checkbox') {
        field.addEventListener('change', hideHandler);
      } else {
        field.addEventListener('input', hideHandler);
        field.addEventListener('change', hideHandler);
        field.addEventListener('focus', hideHandler);
      }
    });
  };

  // 제출 버튼 활성화/비활성 초기 동기화 + 변경 시 동기화
  const syncSubmitState = ()=>{ if(submitBtn && agree) submitBtn.disabled = !agree.checked; };
  syncSubmitState();
  if (agree) agree.addEventListener('change', syncSubmitState);

  // 필드 검증 설정
  setupFieldValidation();

  // 제출 로직: JSON POST
  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    
    // 모든 말풍선 숨김
    form.querySelectorAll('.field-tooltip').forEach(tooltip => {
      tooltip.classList.remove('show');
    });
    
    // 필수 필드 검증
    let isValid = true;
    const requiredFields = form.querySelectorAll('[required]');
    
    requiredFields.forEach(field => {
      const fieldName = field.id || field.name;
      let fieldValid = false;
      
      if (field.type === 'checkbox') {
        fieldValid = field.checked;
      } else if (field.tagName === 'SELECT') {
        fieldValid = field.value && field.value !== '';
      } else {
        fieldValid = field.value && field.value.trim() !== '';
      }
      
      if (!fieldValid) {
        isValid = false;
        showTooltip(fieldName);
      }
    });
    
    // 유효성 검사 실패 시 중단
    if (!isValid) {
      // 첫 번째 유효하지 않은 필드로 스크롤
      const firstInvalid = form.querySelector('[required]:invalid, [required]:not(:checked)');
      if (firstInvalid) {
        const selectInvalid = Array.from(requiredFields).find(f => {
          if (f.type === 'checkbox') return !f.checked;
          if (f.tagName === 'SELECT') return !f.value || f.value === '';
          return !f.value || f.value.trim() === '';
        });
        if (selectInvalid) {
          selectInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      }
      return;
    }

    const data = {
      name:  (form.querySelector('#name')   ?.value || '').trim(),
      gender:(form.querySelector('#gender') ?.value || ''),
      phone: (form.querySelector('#phone')  ?.value || ''),
      birth: (form.querySelector('#birth')  ?.value || ''),
      education:(form.querySelector('#edu') ?.value || ''),
      job:   (form.querySelector('#job')    ?.value || '').trim(),
      region:(form.querySelector('#region') ?.value || ''),
      district:(form.querySelector('#district') ?.value || '').trim(),
      agree: (form.querySelector('#agree')  ?.checked || false)
    };

    if (submitBtn){ submitBtn.disabled = true; submitBtn.textContent = '전송 중…'; }

    try{
      const backendOrigin = ((window.BACKEND_ORIGIN || '').trim() || 'https://ygsa-backend.onrender.com').replace(/\/$/, '');
      const fallbackEndpoint = backendOrigin ? `${backendOrigin}/api/consult` : '/api/consult';
      const endpoint = form.getAttribute('action') || fallbackEndpoint;
      const res = await fetch(endpoint, {
        method:'POST',
        headers:{'Content-Type':'application/json','Accept':'application/json'},
        body: JSON.stringify(data)
      });

      if(res.ok){
        form.reset();
        syncSubmitState();
        alert('신청이 접수되었습니다. 매칭 매니저가 곧 연락드립니다.');
      }else{
        throw new Error('HTTP '+res.status);
      }
    }catch(err){
      console.error(err);
      alert('전송에 실패했습니다. 잠시 후 다시 시도해 주세요.');
    }finally{
      if (submitBtn){ submitBtn.textContent = '무료 상담 신청하기'; syncSubmitState(); }
    }
  });
})();
</script>

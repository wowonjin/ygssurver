<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì—°ê²°ì‚¬ íšŒì› ì •ë³´ ê´€ë¦¬</title>
    <link rel="icon" type="image/png" sizes="32x32" href="image1.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="image1.png" />
    <link rel="apple-touch-icon" href="image1.png" />
    <meta property="og:image" content="image2.png" />
    <meta property="og:image:alt" content="ì—°ê²°ì‚¬ ìƒë‹´ ì„¼í„° ëŒ€í‘œ ì´ë¯¸ì§€" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content="image2.png" />
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
      body.modal-open {
        overflow: hidden;
      }
      :root {
        color-scheme: dark;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", Roboto, "Helvetica Neue", Arial, sans-serif;
        background: #0d1117;
        color: #c9d1d9;
      }
      body.auth-locked {
        overflow: hidden;
      }
      a {
        color: inherit;
      }
      .auth-overlay {
        position: fixed;
        inset: 0;
        background: rgba(13, 17, 23, 0.92);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 200;
        backdrop-filter: blur(6px);
        transition: opacity 0.25s ease, visibility 0.25s ease;
      }
      .auth-overlay.hidden {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
      }
      .auth-dialog {
        width: min(360px, 90vw);
        background: #161b22;
        border: 1px solid #30363d;
        border-radius: 18px;
        padding: 28px;
        display: flex;
        flex-direction: column;
        gap: 18px;
        box-shadow: 0 30px 80px rgba(1, 4, 9, 0.55);
      }
      .auth-dialog h2 {
        margin: 0;
        font-size: 24px;
        color: #f0f6fc;
      }
      .auth-dialog p {
        margin: 0;
        color: #8b949e;
        font-size: 14px;
        line-height: 1.6;
      }
      .auth-dialog label {
        font-size: 14px;
        font-weight: 600;
        color: #c9d1d9;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .auth-dialog input {
        border: 1px solid #30363d;
        background: #0d1117;
        color: #f0f6fc;
        border-radius: 10px;
        padding: 12px 14px;
        font-size: 14px;
      }
      .auth-dialog input:focus {
        outline: none;
        border-color: #1f6feb;
        box-shadow: 0 0 0 2px rgba(31, 111, 235, 0.35);
      }
      .auth-dialog button {
        border: none;
        background: #1f6feb;
        color: #ffffff;
        font-weight: 700;
        padding: 12px 18px;
        border-radius: 12px;
        font-size: 15px;
        cursor: pointer;
        transition: transform 0.15s ease, box-shadow 0.2s ease;
      }
      .auth-dialog button:hover {
        transform: translateY(-1px);
        box-shadow: 0 18px 36px rgba(31, 111, 235, 0.3);
      }
      .auth-error {
        color: #f87171;
        font-size: 14px;
      }
      header {
        padding: 32px clamp(24px, 6vw, 72px);
        border-bottom: 1px solid #30363d;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 24px;
      }
      .header-left {
        display: flex;
        flex-direction: column;
        gap: 14px;
      }
      .header-left button {
        align-self: flex-start;
        border: 1px solid #30363d;
        background: #21262d;
        color: #f0f6fc;
        padding: 10px 18px;
        border-radius: 999px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.15s ease, transform 0.15s ease;
      }
      .header-left button:hover {
        background: #30363d;
        transform: translateY(-1px);
      }
      header h1 {
        margin: 0;
        font-size: clamp(28px, 4vw, 36px);
      }
      .header-links {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
      }
      .header-links a,
      .toolbar-actions button {
        border: 1px solid #2f353d;
        background: #21262d;
        color: #f0f6fc;
        padding: 10px 18px;
        border-radius: 10px;
        font-weight: 600;
        text-decoration: none;
        transition: transform 0.15s ease, background 0.2s ease, box-shadow 0.2s ease;
      }
      .header-links a:hover,
      .toolbar-actions button:hover {
        background: #30363d;
        transform: translateY(-1px);
        box-shadow: 0 12px 24px rgba(13, 17, 23, 0.35);
      }
      main {
        padding: 24px clamp(24px, 5vw, 72px) 64px;
      }
      .stats-summary {
        margin: 24px clamp(24px, 5vw, 72px) 0;
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        font-weight: 600;
        color: #8b949e;
        font-size: clamp(12px, 1.5vw, 15px);
      }
      .stats-summary span {
        margin-right: 12px;
      }
      .toolbar {
        display: flex;
        flex-direction: column;
        gap: 16px;
        margin: 24px clamp(24px, 5vw, 72px) 32px;
      }
      .toolbar-filters {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
      }
      .toolbar button,
      .toolbar select,
      .toolbar input {
        border: 1px solid #30363d;
        background: #21262d;
        color: #f0f6fc;
        padding: 10px 14px;
        border-radius: 8px;
        transition: background 0.15s ease, transform 0.15s ease, border-color 0.2s ease;
        font-family: inherit;
      }
      .toolbar input:focus,
      .toolbar select:focus {
        outline: none;
        border-color: #1f6feb;
        box-shadow: 0 0 0 2px rgba(31, 111, 235, 0.35);
      }
      .toolbar input {
        width: min(260px, 100%);
      }
      .toolbar select {
        min-width: 150px;
      }
      .toolbar-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
        justify-content: flex-start;
      }
      .cards {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 18px;
      }
      .card-top {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 12px;
      }
      .card-title {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .status-chip {
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        background: rgba(48, 54, 61, 0.6);
        color: #9da4b0;
      }
      .status-chip.status-before {
        background: rgba(248, 113, 113, 0.2);
        color: #f87171;
      }
      .status-chip.status-scheduled {
        background: rgba(234, 179, 8, 0.22);
        color: #facc15;
      }
      .status-chip.status-complete {
        background: rgba(34, 197, 94, 0.2);
        color: #4ade80;
      }
      .card-controls {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .card-controls .select-checkbox {
        width: 18px;
        height: 18px;
        cursor: pointer;
        accent-color: #f87171;
      }
      .card-controls .detail-btn {
        border: 1px solid #30363d;
        background: #21262d;
        color: #f0f6fc;
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 13px;
        cursor: pointer;
        transition: background 0.15s ease, transform 0.15s ease;
      }
      .card-controls .detail-btn:hover {
        background: #30363d;
        transform: translateY(-1px);
      }
      .card-footer {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        margin-top: 14px;
      }
      .bulk-action-bar {
        position: fixed;
        left: 50%;
        bottom: 24px;
        transform: translateX(-50%);
        display: flex;
        align-items: center;
        gap: 16px;
        background: rgba(13, 17, 23, 0.92);
        border: 1px solid #30363d;
        border-radius: 999px;
        padding: 12px 20px;
        box-shadow: 0 18px 46px rgba(1, 4, 9, 0.5);
        backdrop-filter: blur(6px);
        z-index: 70;
      }
      .bulk-action-bar[hidden] {
        display: none;
      }
      .bulk-action-bar span {
        font-size: 14px;
        color: #c9d1d9;
      }
      .bulk-action-bar button {
        border: none;
        background: #ef4444;
        color: #ffffff;
        font-weight: 700;
        padding: 10px 18px;
        border-radius: 999px;
        cursor: pointer;
        transition: transform 0.15s ease, box-shadow 0.2s ease;
      }
      .bulk-action-bar button:hover {
        transform: translateY(-1px);
        box-shadow: 0 18px 38px rgba(239, 68, 68, 0.35);
      }
      .calendar-overlay {
        position: fixed;
        inset: 0;
        background: rgba(2, 6, 12, 0.68);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 90;
        padding: 32px clamp(16px, 4vw, 48px);
      }
      .calendar-overlay[hidden] {
        display: none;
      }
      .calendar-dialog {
        width: min(1080px, 100%);
        background: linear-gradient(160deg, rgba(13, 17, 23, 0.92), rgba(13, 17, 23, 0.98));
        border: 1px solid #30363d;
        border-radius: 28px;
        box-shadow: 0 40px 120px rgba(1, 4, 9, 0.6);
        padding: 32px clamp(24px, 4vw, 40px);
        display: flex;
        flex-direction: column;
        gap: 24px;
      }
      .calendar-dialog header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 16px;
        padding: 0;
        border: none;
      }
      .calendar-dialog header h2 {
        margin: 0;
        font-size: 26px;
      }
      .calendar-dialog header button.close {
        border: none;
        background: transparent;
        color: #8b949e;
        font-size: 30px;
        cursor: pointer;
      }
      .calendar-dialog header button.close:hover {
        color: #f0f6fc;
      }
      .calendar-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 16px;
      }
      .calendar-nav {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .calendar-nav h3 {
        margin: 0;
        font-size: 20px;
      }
      .calendar-nav button,
      .calendar-today {
        border: 1px solid #30363d;
        background: #21262d;
        color: #f0f6fc;
        padding: 8px 14px;
        border-radius: 999px;
        cursor: pointer;
        transition: background 0.15s ease, transform 0.15s ease;
      }
      .calendar-nav button:hover,
      .calendar-today:hover {
        background: #30363d;
        transform: translateY(-1px);
      }
      .calendar-layout {
        display: grid;
        grid-template-columns: minmax(0, 3fr) minmax(260px, 1fr);
        gap: 24px;
        align-items: start;
      }
      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, minmax(0, 1fr));
        gap: 8px;
      }
      .calendar-weekday {
        text-align: center;
        font-size: 13px;
        font-weight: 600;
        color: #8b949e;
        padding-bottom: 4px;
      }
      .calendar-day {
        border: 1px solid rgba(48, 54, 61, 0.6);
        border-radius: 14px;
        padding: 12px 10px;
        min-height: 92px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        background: rgba(22, 27, 34, 0.82);
        cursor: pointer;
        transition: border-color 0.15s ease, transform 0.15s ease;
      }
      .calendar-day:hover {
        border-color: #1f6feb;
        transform: translateY(-2px);
      }
      .calendar-day.other-month {
        opacity: 0.35;
      }
      .calendar-day.today {
        border-color: #1f6feb;
        box-shadow: 0 0 0 1px #1f6feb;
      }
      .calendar-day.selected {
        background: rgba(31, 110, 235, 0.18);
        border-color: #3b82f6;
      }
      .calendar-day .day-number {
        font-weight: 700;
        font-size: 15px;
      }
      .calendar-day .day-count {
        align-self: flex-end;
        font-size: 12px;
        color: #8b949e;
      }
      .calendar-day.has-events .day-count {
        background: rgba(63, 185, 80, 0.2);
        color: #32d583;
        padding: 2px 8px;
        border-radius: 999px;
      }
      .calendar-panel {
        border: 1px solid rgba(48, 54, 61, 0.6);
        border-radius: 18px;
        background: rgba(13, 17, 23, 0.95);
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 16px;
        min-height: 260px;
      }
      .calendar-panel h4 {
        margin: 0;
        font-size: 18px;
      }
      .calendar-appointments {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .calendar-appointments li {
        border: 1px solid rgba(48, 54, 61, 0.6);
        border-radius: 16px;
        padding: 12px 14px;
        background: rgba(22, 27, 34, 0.92);
        display: flex;
        flex-direction: column;
        gap: 6px;
        cursor: pointer;
        transition: transform 0.15s ease, border-color 0.15s ease;
      }
      .calendar-appointments li:hover {
        transform: translateY(-1px);
        border-color: #1f6feb;
      }
      .calendar-appointments li time {
        font-size: 15px;
        font-weight: 700;
      }
      .calendar-appointments li span {
        font-size: 13px;
        color: #8b949e;
      }
      .calendar-appointments li .meta-line {
        font-size: 12px;
        color: #9da4b0;
      }
      .calendar-appointments li .note-line {
        color: #c9d1d9;
        font-size: 12px;
      }
      .calendar-appointments .calendar-empty-item {
        border: 1px dashed rgba(48, 54, 61, 0.7);
        background: transparent;
        color: #8b949e;
        cursor: default;
      }
      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(2, 6, 12, 0.65);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 80;
        padding: 24px;
      }
      .modal-overlay[hidden] {
        display: none;
      }
      .modal-content {
        width: min(1080px, 95vw);
        max-height: min(92vh, 860px);
        background: #0d1117;
        border: 1px solid #30363d;
        border-radius: 20px;
        box-shadow: 0 30px 80px rgba(1, 4, 9, 0.55);
        padding: 28px;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 12px;
      }
      .modal-header h2 {
        margin: 0;
        font-size: 22px;
        color: #f0f6fc;
      }
      .modal-header button {
        border: none;
        background: transparent;
        color: #8b949e;
        font-size: 22px;
        cursor: pointer;
      }
      .modal-header button:hover {
        color: #f0f6fc;
      }
      .modal-subtitle {
        margin: 0;
        color: #8b949e;
        font-size: 14px;
      }
      .detail-fields {
        padding: 0;
      }
      .detail-fields .field-grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 24px;
      }
      .detail-fields .field {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .modal-form {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      .modal-form .field {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .modal-form label {
        display: block;
        font-size: 13px;
        color: #c9d1d9;
        margin-bottom: 6px;
        font-weight: 600;
      }
      .modal-form input[type='text'],
      .modal-form input[type='tel'],
      .modal-form select,
      .modal-form input[type='date'],
      .modal-form textarea,
      .modal-form .time-select {
        width: 100%;
        border: 1px solid #30363d;
        background: #161b22;
        color: #f0f6fc;
        border-radius: 10px;
        padding: 12px 14px;
        font-family: inherit;
        font-size: 14px;
      }
      .modal-form textarea {
        min-height: 100px;
        resize: vertical;
      }
      .detail-secondary-grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 24px;
      }
      .detail-secondary-grid .span-2 {
        grid-column: span 2;
      }
      .detail-preferences-grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 24px;
      }
      .detail-preferences-grid select[multiple] {
        min-height: 160px;
      }
      .full-width {
        grid-column: 1 / -1;
      }
      .detail-notes textarea {
        min-height: 140px;
      }
      .modal-form .inline-group {
        display: flex;
        gap: 12px;
        align-items: center;
      }
      .modal-form .inline-group > *:first-child {
        flex: 1;
      }
      .modal-form .inline-group button {
        border: 1px solid #30363d;
        background: #21262d;
        color: #f0f6fc;
        padding: 10px 14px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 13px;
      }
      .modal-form .inline-group button:hover {
        background: #30363d;
      }
      .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 12px;
        margin-top: 8px;
      }
      .modal-actions button {
        padding: 12px 20px;
        border-radius: 12px;
        border: none;
        font-weight: 700;
        cursor: pointer;
      }
      .modal-actions .secondary {
        background: #21262d;
        color: #c9d1d9;
      }
      .modal-actions .secondary:hover {
        background: #30363d;
      }
      .modal-actions .primary {
        background: #1f6feb;
        color: #ffffff;
        box-shadow: 0 18px 36px rgba(31, 110, 235, 0.3);
      }
      .modal-actions .primary:hover {
        transform: translateY(-1px);
      }
      .card {
        background: linear-gradient(160deg, #161b22 0%, #0d1117 100%);
        border: 1px solid #30363d;
        border-radius: 16px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 16px;
        box-shadow: 0 18px 36px rgba(1, 4, 9, 0.4);
      }
      .card h2 {
        margin: 0;
        font-size: 20px;
        color: #f0f6fc;
      }
      .meta {
        font-size: 13px;
        color: #8b949e;
      }
      dl {
        margin: 0;
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 12px;
        font-size: 14px;
      }
      dt {
        color: #6e7681;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-size: 12px;
      }
      dd {
        margin: 4px 0 0;
        font-weight: 600;
        color: #c9d1d9;
      }
      .empty {
        text-align: center;
        padding: 80px 24px;
        border: 1px dashed #30363d;
        border-radius: 16px;
        color: #8b949e;
      }
      .toast {
        position: fixed;
        right: 24px;
        bottom: 24px;
        padding: 14px 18px;
        background: rgba(35, 134, 54, 0.12);
        border: 1px solid rgba(63, 185, 80, 0.45);
        border-radius: 12px;
        color: #3fb950;
        font-weight: 600;
        opacity: 0;
        transform: translateY(12px);
        transition: opacity 0.3s ease, transform 0.3s ease;
        pointer-events: none;
      }
      .toast.show {
        opacity: 1;
        transform: translateY(0);
      }
      .sticky-note {
        position: fixed;
        right: 18px;
        bottom: 120px;
        width: min(320px, 80vw);
        background: rgba(13, 17, 23, 0.72);
        border: 1px solid #30363d;
        border-radius: 12px;
        box-shadow: 0 18px 40px rgba(1, 4, 9, 0.48);
        backdrop-filter: blur(6px);
        color: #c9d1d9;
        padding: 14px 18px;
        font-size: 14px;
        line-height: 1.6;
        z-index: 60;
      }
      @media (max-width: 1200px) {
        .detail-fields .field-grid,
        .detail-secondary-grid,
        .detail-preferences-grid {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
        .detail-secondary-grid .span-2,
        .full-width {
          grid-column: span 2;
        }
      }
      @media (max-width: 640px) {
        header {
          padding: 24px 20px;
          flex-direction: column;
          align-items: stretch;
        }
        .header-left button {
          width: 100%;
          text-align: center;
        }
        .header-links {
          flex-direction: column;
          gap: 10px;
        }
        .toolbar-actions {
          justify-content: flex-start;
        }
        .toolbar-actions button {
          width: 100%;
        }
        .stats-summary {
          margin: 20px;
          flex-direction: column;
          gap: 6px;
          font-size: 14px;
        }
        .bulk-action-bar {
          left: 12px;
          right: 12px;
          transform: none;
          border-radius: 18px;
          flex-direction: column;
          align-items: stretch;
          gap: 10px;
        }
        .bulk-action-bar button {
          width: 100%;
        }
        main {
          padding: 20px;
        }
        dl {
          grid-template-columns: 1fr;
        }
        .card-title {
          flex-direction: column;
          align-items: flex-start;
          gap: 6px;
        }
        .status-chip {
          align-self: flex-start;
        }
        .detail-preferences-grid,
        .detail-fields .field-grid,
        .detail-secondary-grid {
          grid-template-columns: 1fr;
        }
        .detail-secondary-grid .span-2,
        .full-width {
          grid-column: span 1;
        }
        .sticky-note {
          display: none;
        }
      }
    </style>
    <script src="backend-config.js"></script>
  </head>
  <body class="auth-locked">
    <div id="authOverlay" class="auth-overlay" role="dialog" aria-modal="true">
      <form id="authForm" class="auth-dialog" novalidate>
        <h2>ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
        <p>ìƒë‹´ ëŒ€ì‹œë³´ë“œë¥¼ í™•ì¸í•˜ë ¤ë©´ ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</p>
        <label>
          ì•„ì´ë””
          <input id="authId" type="text" autocomplete="username" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required />
        </label>
        <label>
          ë¹„ë°€ë²ˆí˜¸
          <input
            id="authPassword"
            type="password"
            autocomplete="current-password"
            placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
            required
          />
        </label>
        <div id="authError" class="auth-error" role="alert" hidden>ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
        <button type="submit">ì ‘ì†í•˜ê¸°</button>
      </form>
    </div>
    <div id="appContent" hidden>
    <header>
      <div class="header-left">
        <h1>ì—°ê²°ì‚¬ ìƒë‹´ ì„¼í„°</h1>
        <button type="button" id="calendarScrollBtn">ìº˜ë¦°ë” ë³´ê¸°</button>
      </div>
      <div class="header-links">
        <a href="https://yeongyeolsa.imweb.me/admin/?type=page&_gl=1*zufqzi*_gcl_au*MTY3OTEyMjExNS4xNzYwNDk3ODM3LjE1NzI0MTM0ODIuMTc2MjE1NjIzNC4xNzYyMTU2Mjc1*_ga*NTAyMzEzOC4xNzYwNjc3MTc0*_ga_HP37L08LP3*czE3NjIxNTYyMjckbzYkZzEkdDE3NjIxNTYyNzgkajkkbDAkaDA.&_ga=2.97118614.820021611.1762135185-5023138.1760677174" target="_blank" rel="noopener noreferrer">Admin</a>
        <a href="https://ygsa.co.kr/" target="_blank" rel="noopener noreferrer">Website</a>
        <a href="https://www.notion.so/29ef5285ecb6807cb866c135f877c7a3?source=copy_link" target="_blank" rel="noopener noreferrer">Notion</a>
        <a href="https://dashboard.render.com/web/srv-d47j4nshg0os73fnnhd0/deploys/dep-d48ish3e5dus73c7t7ng" target="_blank" rel="noopener noreferrer">Server</a>
          <a href="https://github.com/wowonjin/ygsa" target="_blank" rel="noopener noreferrer">GitHub</a>
      </div>
    </header>
    <section class="stats-summary" aria-label="ìƒë‹´ í˜„í™©">
      <span id="statTotal">ì´ ìƒë‹´ ì¸ì›: 0ëª…</span>
      <span id="statMonthly">ì›”ê°„ ìƒë‹´ ì¸ì›: 0ëª…</span>
      <span id="statWeekly">ì£¼ê°„ ìƒë‹´ ì¸ì›: 0ëª…</span>
      <span id="statDaily">ì˜¤ëŠ˜ ìƒë‹´ ì¸ì›: 0ëª…</span>
    </section>
    <section class="toolbar" aria-label="í•„í„°">
      <div class="toolbar-filters">
        <input type="search" id="searchInput" placeholder="ì´ë¦„, ì—°ë½ì²˜, ì‹ ì¥, ì§ì—… ê²€ìƒ‰" aria-label="ê²€ìƒ‰" />
        <select id="genderFilter" aria-label="ì„±ë³„ í•„í„°">
          <option value="all">ì„±ë³„ ì „ì²´</option>
        </select>
        <select id="heightFilter" aria-label="ì‹ ì¥ í•„í„°">
          <option value="all">ì‹ ì¥ ì „ì²´</option>
        </select>
        <select id="sortSelect" aria-label="ì •ë ¬">
          <option value="latest">ìµœì‹  ìˆœ</option>
          <option value="oldest">ì˜¤ë˜ëœ ìˆœ</option>
          <option value="name">ì´ë¦„ ìˆœ</option>
          <option value="height">ì‹ ì¥ ìˆœ</option>
        </select>
      </div>
      <div class="toolbar-actions">
        <button type="button" id="exportBtn">ì—‘ì…€ë¡œ ë‚´ë³´ë‚´ê¸°</button>
        <button type="button" id="importBtn">ì—‘ì…€ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <input type="file" id="excelInput" accept=".xlsx,.xls" hidden />
      </div>
    </section>
    <main>
      <section id="cardsContainer" class="cards"></section>
      <div id="emptyState" class="empty" hidden>ì•„ì§ ì ‘ìˆ˜ëœ ìƒë‹´ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</div>
    </main>
    <div id="toast" class="toast">ìƒˆë¡œìš´ ìƒë‹´ ì‹ ì²­ì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤!</div>
    <div class="calendar-overlay" id="calendarModal" hidden>
      <div class="calendar-dialog">
        <header>
          <h2>ëŒ€ë©´ ìƒë‹´ ìº˜ë¦°ë”</h2>
          <button type="button" class="close" id="calendarCloseBtn" aria-label="ë‹«ê¸°">Ã—</button>
        </header>
        <div class="calendar-controls">
          <div class="calendar-nav">
            <button type="button" id="calendarPrevBtn" aria-label="ì´ì „ ë‹¬">â—€</button>
            <h3 id="calendarCurrentMonth">2025ë…„ 1ì›”</h3>
            <button type="button" id="calendarNextBtn" aria-label="ë‹¤ìŒ ë‹¬">â–¶</button>
          </div>
          <button type="button" id="calendarTodayBtn" class="calendar-today">ì˜¤ëŠ˜</button>
        </div>
        <div class="calendar-layout">
          <div class="calendar-grid" id="calendarGrid" role="grid"></div>
          <aside class="calendar-panel">
            <h4 id="calendarSelectedTitle">ì„ íƒëœ ì¼ì •</h4>
            <ul id="calendarAppointmentList" class="calendar-appointments"></ul>
          </aside>
        </div>
      </div>
    </div>
    <div class="modal-overlay" id="detailModal" hidden>
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="detailTitle">ìƒì„¸ ì •ë³´</h2>
          <button type="button" id="detailCloseBtn" aria-label="ë‹«ê¸°">Ã—</button>
        </div>
        <p class="modal-subtitle" id="detailSubtitle"></p>
        <form id="detailForm" class="modal-form">
          <div class="detail-fields" aria-live="polite">
            <div class="field-grid">
              <div class="field">
                <label for="detailName">ì„±ëª…</label>
                <input id="detailName" type="text" autocomplete="name" required />
              </div>
              <div class="field">
                <label for="detailPhone">ì—°ë½ì²˜</label>
                <input
                  id="detailPhone"
                  type="tel"
                  inputmode="tel"
                  autocomplete="tel-national"
                  placeholder="010-1234-5678"
                  required
                />
              </div>
              <div class="field">
                <label for="detailMbti">MBTI</label>
                <input id="detailMbti" type="text" placeholder="ì˜ˆ: ENFP" />
              </div>
              <div class="field">
                <label for="detailGender">ì„±ë³„</label>
                <select id="detailGender" required>
                  <option value="">ì„ íƒ</option>
                  <option value="ë‚¨">ë‚¨ì</option>
                  <option value="ì—¬">ì—¬ì</option>
                </select>
              </div>
              <div class="field">
                <label for="detailBirth">ìƒë…„</label>
                <input
                  id="detailBirth"
                  type="text"
                  inputmode="numeric"
                  maxlength="6"
                  placeholder="1998ë…„"
                  required
                />
              </div>
              <div class="field">
                <label for="detailHeight">ì‹ ì¥</label>
                <input
                  id="detailHeight"
                  type="text"
                  inputmode="numeric"
                  maxlength="5"
                  placeholder="170cm"
                  required
                />
              </div>
              <div class="field">
                <label for="detailEducation">ìµœì¢…í•™ë ¥</label>
                <select id="detailEducation" required>
                  <option value="">ì„ íƒ</option>
                  <optgroup label="ê³ ë“±êµìœ¡ ì´ì „">
                    <option>ê³ ë“±í•™êµ ì¬í•™</option>
                    <option>ê³ ë“±í•™êµ ì¡¸ì—…(ê²€ì •ê³ ì‹œ í¬í•¨)</option>
                  </optgroup>
                  <optgroup label="ì „ë¬¸ëŒ€(2Â·3ë…„)">
                    <option>ì „ë¬¸ëŒ€ ì¬í•™</option>
                    <option>ì „ë¬¸í•™ì‚¬ ì¡¸ì—…</option>
                  </optgroup>
                  <optgroup label="ëŒ€í•™êµ(4ë…„)">
                    <option>ëŒ€í•™êµ ì¬í•™(4ë…„)</option>
                    <option>í•™ì‚¬ ì¡¸ì—…</option>
                  </optgroup>
                  <optgroup label="ëŒ€í•™ì›">
                    <option>ì„ì‚¬ ê³¼ì • ì¬í•™</option>
                    <option>ì„ì‚¬ ì¡¸ì—…</option>
                    <option>ë°•ì‚¬ ê³¼ì • ì¬í•™</option>
                    <option>ë°•ì‚¬ ì¡¸ì—…</option>
                  </optgroup>
                  <optgroup label="ê¸°íƒ€">
                    <option>í•´ì™¸ ëŒ€í•™ ì¬í•™/ì¡¸ì—…</option>
                    <option>ê¸°íƒ€</option>
                  </optgroup>
                </select>
              </div>
              <div class="field">
                <label for="detailUniversity">ëŒ€í•™êµ</label>
                <input id="detailUniversity" type="text" placeholder="ì˜ˆ: ì„œìš¸ëŒ€í•™êµ (ê´€ì•…ìº í¼ìŠ¤)" />
              </div>
              <div class="field">
                <label for="detailSalaryRange">ì—°ë´‰ (ì„¸ì „ ê¸°ì¤€)</label>
                <select id="detailSalaryRange">
                  <option value="">ì„ íƒ</option>
                  <option value="1">1) 3000ë§Œì› ë¯¸ë§Œ</option>
                  <option value="2">2) 3000-4000</option>
                  <option value="3">3) 4000-6000</option>
                  <option value="4">4) 6000-8000</option>
                  <option value="5">5) 8000-1ì–µ</option>
                  <option value="6">6) 1ì–µ-2ì–µ</option>
                  <option value="7">7) 2ì–µ-3ì–µ</option>
                  <option value="8">8) 3ì–µ ì´ìƒ</option>
                </select>
              </div>
              <div class="field">
                <label for="detailJob">ì§ì—…</label>
                <input
                  id="detailJob"
                  type="text"
                  placeholder="ì˜ˆ: ì¤‘ê²¬ ë¬´ì—­íšŒì‚¬ í•´ì™¸ì˜ì—…"
                  autocomplete="organization"
                  required
                />
              </div>
              <div class="field">
                <label for="detailDistrict">ê±°ì£¼ êµ¬</label>
                <input id="detailDistrict" type="text" placeholder="ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬" required />
              </div>
              <div class="field full-width">
                <label for="detailJobDetail">ì§ì—…/ì§ë¬´ ìƒì„¸</label>
                <textarea
                  id="detailJobDetail"
                  placeholder="ì˜ˆ: ì¤‘ê²¬ ë¬´ì—­íšŒì‚¬ í•´ì™¸ì˜ì—…íŒ€ì—ì„œ ë¶ë¯¸ ì‹œì¥ ë‹´ë‹¹"
                ></textarea>
              </div>
              <div class="field full-width">
                <label for="detailProfileAppeal">ì¶”ê°€ ì–´í•„</label>
                <textarea
                  id="detailProfileAppeal"
                  placeholder="ì—°ë´‰, ìì‚°, í•™ë ¥ ë“± í”„ë¡œí•„ì— ê°•ì¡°í•˜ê³  ì‹¶ì€ ë‚´ìš©ì„ ì ì–´ì£¼ì„¸ìš”."
                ></textarea>
              </div>
              <div class="field">
                <label for="detailSmoking">í¡ì—°</label>
                <select id="detailSmoking">
                  <option value="">ì„ íƒ</option>
                  <option value="ë¹„í¡ì—°">ë¹„í¡ì—°</option>
                  <option value="ì‚¬íšŒì  í¡ì—°">ì‚¬íšŒì  í¡ì—°</option>
                  <option value="í¡ì—°">í¡ì—°</option>
                </select>
              </div>
              <div class="field">
                <label for="detailReligion">ì¢…êµ</label>
                <select id="detailReligion">
                  <option value="">ì„ íƒ</option>
                  <option value="ë¬´êµ">ë¬´êµ</option>
                  <option value="ê¸°ë…êµ">ê¸°ë…êµ</option>
                  <option value="ì²œì£¼êµ">ì²œì£¼êµ</option>
                  <option value="ë¶ˆêµ">ë¶ˆêµ</option>
                  <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                </select>
              </div>
            </div>
          </div>
          <div class="detail-secondary-grid">
            <div class="field">
              <label for="detailPhoneStatus">ì „í™” ìƒë‹´ ìƒíƒœ</label>
              <select id="detailPhoneStatus">
                <option value="pending">ìƒë‹´ ì „</option>
                <option value="scheduled">ìƒë‹´ ì˜ˆì •</option>
                <option value="done">ìƒë‹´ ì™„ë£Œ</option>
              </select>
            </div>
            <div class="field span-2">
              <label>ëŒ€ë©´ ìƒë‹´ ì¼ì • (15ë¶„ ë‹¨ìœ„)</label>
              <div class="inline-group">
                <input type="date" id="detailDate" />
                <select id="detailTime" class="time-select" disabled>
                  <option value="">ì‹œê°„ ì„ íƒ</option>
                </select>
                <button type="button" id="detailClearSchedule" aria-label="ì¼ì • ì´ˆê¸°í™”">ğŸ—‘</button>
              </div>
              <p class="modal-subtitle" id="detailScheduleInfo"></p>
            </div>
          </div>
          <div class="detail-preferences-grid">
            <div class="field">
              <label for="detailPreferredHeights">ì„ í˜¸í•˜ëŠ” í‚¤ (ì¤‘ë³µ ì„ íƒ ê°€ëŠ¥)</label>
              <select id="detailPreferredHeights" multiple size="6">
                <option value="160cm ì´í•˜">160cm ì´í•˜</option>
                <option value="161-165cm">161-165cm</option>
                <option value="166-170cm">166-170cm</option>
                <option value="171-175cm">171-175cm</option>
                <option value="176-180cm">176-180cm</option>
                <option value="181cm ì´ìƒ">181cm ì´ìƒ</option>
              </select>
            </div>
            <div class="field">
              <label for="detailPreferredAges">ì„ í˜¸ ë‚˜ì´ (ì¤‘ë³µ ì„ íƒ ê°€ëŠ¥)</label>
              <select id="detailPreferredAges" multiple size="6">
                <option value="20ëŒ€ ì´ˆë°˜">20ëŒ€ ì´ˆë°˜</option>
                <option value="20ëŒ€ ì¤‘ë°˜">20ëŒ€ ì¤‘ë°˜</option>
                <option value="20ëŒ€ í›„ë°˜">20ëŒ€ í›„ë°˜</option>
                <option value="30ëŒ€ ì´ˆë°˜">30ëŒ€ ì´ˆë°˜</option>
                <option value="30ëŒ€ ì¤‘ë°˜">30ëŒ€ ì¤‘ë°˜</option>
                <option value="30ëŒ€ í›„ë°˜ ì´ìƒ">30ëŒ€ í›„ë°˜ ì´ìƒ</option>
              </select>
            </div>
            <div class="field">
              <label for="detailValues">ì¸ìƒì˜ ì£¼ìš” ê°€ì¹˜ê´€ (ìµœëŒ€ 2ê°œ)</label>
              <select id="detailValues" multiple size="6">
                <option value="í•˜ë£¨í•˜ë£¨ ìµœì„ ì„ ë‹¤í•˜ëŠ”">í•˜ë£¨í•˜ë£¨ ìµœì„ ì„ ë‹¤í•˜ëŠ”</option>
                <option value="í™”ëª©í•œ ê°€ì¡±ì´ ì¤‘ì‹¬ì´ ë˜ëŠ”">í™”ëª©í•œ ê°€ì¡±ì´ ì¤‘ì‹¬ì´ ë˜ëŠ”</option>
                <option value="ê±´ê°•ê´€ë¦¬ì— ì² ì €í•œ">ê±´ê°•ê´€ë¦¬ì— ì² ì €í•œ</option>
                <option value="ì¼ê³¼ ì‚¬ë‘ ëª¨ë‘ ì„±ê³µí•˜ëŠ”">ì¼ê³¼ ì‚¬ë‘ ëª¨ë‘ ì„±ê³µí•˜ëŠ”</option>
                <option value="ì‚¬ë‘í•˜ë©´ ë§ì¶°ì£¼ëŠ”(ì´í•´í•˜ëŠ”)">ì‚¬ë‘í•˜ë©´ ë§ì¶°ì£¼ëŠ”(ì´í•´í•˜ëŠ”)</option>
              </select>
              <input
                id="detailValuesCustom"
                type="text"
                placeholder="ê¸°íƒ€ ê°€ì¹˜ê´€ (ì§ì ‘ ì…ë ¥)"
              />
            </div>
            <div class="field full-width">
              <label for="detailSufficientCondition">ì¶©ë¶„ì¡°ê±´</label>
              <textarea
                id="detailSufficientCondition"
                placeholder="ì¶©ë¶„ì¡°ê±´ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."
              ></textarea>
            </div>
            <div class="field full-width">
              <label for="detailNecessaryCondition">í•„ìš”ì¡°ê±´</label>
              <textarea
                id="detailNecessaryCondition"
                placeholder="í•„ìš”ì¡°ê±´ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."
              ></textarea>
            </div>
            <div class="field full-width">
              <label for="detailLikesDislikes">ì¢‹ì•„í•˜ëŠ” ê²ƒ / ì‹«ì–´í•˜ëŠ” ê²ƒ</label>
              <textarea
                id="detailLikesDislikes"
                placeholder="ì¢‹ì•„í•˜ëŠ” ê²ƒê³¼ ì‹«ì–´í•˜ëŠ” ê²ƒì„ ì ì–´ì£¼ì„¸ìš”."
              ></textarea>
            </div>
            <div class="field full-width">
              <label for="detailAboutMe">'ì €ëŠ” ì´ëŸ° ì‚¬ëŒì…ë‹ˆë‹¤'</label>
              <textarea
                id="detailAboutMe"
                placeholder="ì–´í•„í•  ìˆ˜ ìˆëŠ” ë§¤ë ¥í¬ì¸íŠ¸ë‚˜ ì„±ê²©ì„ ì ì–´ì£¼ì„¸ìš”."
              ></textarea>
            </div>
            <div class="field full-width detail-notes">
              <label for="detailNotes">ê´€ë¦¬ì ë©”ëª¨</label>
              <textarea id="detailNotes" placeholder="ìƒë‹´ ê¸°ë¡ì´ë‚˜ ì°¸ê³  ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
            </div>
          </div>
          <div class="modal-actions">
            <button type="button" class="secondary" id="detailCancelBtn">ì·¨ì†Œ</button>
            <button type="submit" class="primary">ì €ì¥</button>
          </div>
        </form>
      </div>
    </div>
    <div class="bulk-action-bar" id="bulkActionBar" hidden>
      <span id="selectionInfo"></span>
      <button type="button" id="deleteSelectedBtn">ì •ë³´ ì‚­ì œí•˜ê¸°</button>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script>
      const ADMIN_ID = 'admin'
      const ADMIN_PASSWORD = 'admin'
      const authOverlay = document.getElementById('authOverlay')
      const authForm = document.getElementById('authForm')
      const authIdInput = document.getElementById('authId')
      const authPasswordInput = document.getElementById('authPassword')
      const authErrorEl = document.getElementById('authError')
      const appContentEl = document.getElementById('appContent')
      let isAuthenticated = false
      let appInitialized = false

      function initializeApp() {
        if (appInitialized) return
        appInitialized = true
        updateStats()
        loadData()
        setupSSE()
      }

      function unlockApp() {
        isAuthenticated = true
        if (authOverlay) {
          authOverlay.classList.add('hidden')
          setTimeout(() => authOverlay?.setAttribute('hidden', ''), 260)
        }
        if (appContentEl) {
          appContentEl.hidden = false
        }
        document.body.classList.remove('auth-locked')
        initializeApp()
      }

      if (authForm) {
        authForm.addEventListener('submit', (event) => {
          event.preventDefault()
          const id = authIdInput?.value.trim()
          const pw = authPasswordInput?.value || ''
          if (id === ADMIN_ID && pw === ADMIN_PASSWORD) {
            if (authErrorEl) authErrorEl.hidden = true
            unlockApp()
          } else {
            if (authErrorEl) {
              authErrorEl.hidden = false
              authErrorEl.textContent = 'ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'
            }
            authPasswordInput?.focus()
            authPasswordInput?.select?.()
          }
        })
        authIdInput?.focus()
      }

      const HOSTNAME = window.location && window.location.hostname
      const IS_LOCAL_HOST = /^(localhost|127\.0\.0\.1)$/i.test(HOSTNAME || '')
      const DEFAULT_BACKEND_ORIGIN = IS_LOCAL_HOST
        ? 'http://localhost:5000'
        : 'https://ygsa-backend.onrender.com'
      const BACKEND_ORIGIN_RAW = (window.BACKEND_ORIGIN || '').trim()
      const BACKEND_ORIGIN = (BACKEND_ORIGIN_RAW || DEFAULT_BACKEND_ORIGIN).replace(/\/$/, '')
      const API_BASE_URL = BACKEND_ORIGIN
      const API_URL = `${API_BASE_URL}/api/consult`
      const API_IMPORT_URL = `${API_BASE_URL}/api/consult/import`
      const EVENTS_URL = `${API_BASE_URL}/events`
      if (!BACKEND_ORIGIN_RAW) {
        console.info(`[ygsa] BACKEND_ORIGIN ë¯¸ì„¤ì • â€“ ê¸°ë³¸ê°’ ${API_BASE_URL} ì‚¬ìš©`)
      }
      const cardsEl = document.getElementById('cardsContainer')
      const emptyEl = document.getElementById('emptyState')
      const exportBtn = document.getElementById('exportBtn')
      const importBtn = document.getElementById('importBtn')
      const excelInput = document.getElementById('excelInput')
      const deleteSelectedBtn = document.getElementById('deleteSelectedBtn')
      const selectionInfoEl = document.getElementById('selectionInfo')
      const bulkActionBar = document.getElementById('bulkActionBar')
      const toastEl = document.getElementById('toast')
      const statTotalEl = document.getElementById('statTotal')
      const statMonthlyEl = document.getElementById('statMonthly')
      const statWeeklyEl = document.getElementById('statWeekly')
      const statDailyEl = document.getElementById('statDaily')
      const searchInput = document.getElementById('searchInput')
      const genderFilter = document.getElementById('genderFilter')
      const heightFilter = document.getElementById('heightFilter')
      const sortSelect = document.getElementById('sortSelect')
      const detailModal = document.getElementById('detailModal')
      const detailForm = document.getElementById('detailForm')
      const detailCloseBtn = document.getElementById('detailCloseBtn')
      const detailCancelBtn = document.getElementById('detailCancelBtn')
      const detailTitleEl = document.getElementById('detailTitle')
      const detailSubtitleEl = document.getElementById('detailSubtitle')
      const detailNameInput = document.getElementById('detailName')
      const detailPhoneInput = document.getElementById('detailPhone')
      const detailGenderSelect = document.getElementById('detailGender')
      const detailBirthInput = document.getElementById('detailBirth')
      const detailHeightInput = document.getElementById('detailHeight')
      const detailEducationSelect = document.getElementById('detailEducation')
      const detailJobInput = document.getElementById('detailJob')
      const detailDistrictInput = document.getElementById('detailDistrict')
      const detailMbtiInput = document.getElementById('detailMbti')
      const detailUniversityInput = document.getElementById('detailUniversity')
      const detailSalaryRangeSelect = document.getElementById('detailSalaryRange')
      const detailJobDetailInput = document.getElementById('detailJobDetail')
      const detailProfileAppealInput = document.getElementById('detailProfileAppeal')
      const detailSmokingSelect = document.getElementById('detailSmoking')
      const detailReligionSelect = document.getElementById('detailReligion')
      const detailPreferredHeightsSelect = document.getElementById('detailPreferredHeights')
      const detailPreferredAgesSelect = document.getElementById('detailPreferredAges')
      const detailSufficientConditionInput = document.getElementById('detailSufficientCondition')
      const detailNecessaryConditionInput = document.getElementById('detailNecessaryCondition')
      const detailLikesDislikesInput = document.getElementById('detailLikesDislikes')
      const detailValuesSelect = document.getElementById('detailValues')
      const detailValuesCustomInput = document.getElementById('detailValuesCustom')
      const detailAboutMeInput = document.getElementById('detailAboutMe')
      const detailPhoneStatusEl = document.getElementById('detailPhoneStatus')
      const detailDateInput = document.getElementById('detailDate')
      const detailTimeSelect = document.getElementById('detailTime')
      const detailClearScheduleBtn = document.getElementById('detailClearSchedule')
      const detailNotesInput = document.getElementById('detailNotes')
      const detailScheduleInfo = document.getElementById('detailScheduleInfo')
      const calendarScrollBtn = document.getElementById('calendarScrollBtn')
      const calendarModal = document.getElementById('calendarModal')
      const calendarCloseBtn = document.getElementById('calendarCloseBtn')
      const calendarPrevBtn = document.getElementById('calendarPrevBtn')
      const calendarNextBtn = document.getElementById('calendarNextBtn')
      const calendarTodayBtn = document.getElementById('calendarTodayBtn')
      const calendarCurrentMonthEl = document.getElementById('calendarCurrentMonth')
      const calendarSelectedTitleEl = document.getElementById('calendarSelectedTitle')
      const calendarAppointmentList = document.getElementById('calendarAppointmentList')
      const calendarGrid = document.getElementById('calendarGrid')
      let items = []
      const selectedIds = new Set()
      let suppressDeleteToast = false
      let suppressUpdateToast = false
      let detailRecordId = null
      const viewState = {
        search: '',
        gender: 'all',
        height: 'all',
        sort: 'latest',
      }
      const calendarState = {
        current: new Date(),
        selectedDate: '',
      }
      const PHONE_STATUS_VALUES = ['pending', 'scheduled', 'done']
      const PHONE_STATUS_LABELS = {
        pending: 'ìƒë‹´ ì „',
        scheduled: 'ìƒë‹´ ì˜ˆì •',
        done: 'ìƒë‹´ ì™„ë£Œ',
      }
      const STATUS_CLASS_NAMES = {
        pending: 'status-before',
        scheduled: 'status-scheduled',
        done: 'status-complete',
      }
      const TIME_SLOT_START_HOUR = 9
      const TIME_SLOT_END_HOUR = 21
      const TIME_SLOT_INTERVAL_MINUTES = 15
      const SALARY_RANGE_LABELS = {
        '1': '3000ë§Œì› ë¯¸ë§Œ',
        '2': '3000-4000ë§Œì›',
        '3': '4000-6000ë§Œì›',
        '4': '6000-8000ë§Œì›',
        '5': '8000-1ì–µì›',
        '6': '1ì–µ-2ì–µì›',
        '7': '2ì–µ-3ì–µì›',
        '8': '3ì–µì› ì´ìƒ',
      }
      let detailValuesSelection = []

      exportBtn.addEventListener('click', exportToExcel)
      importBtn.addEventListener('click', () => excelInput.click())
      excelInput.addEventListener('change', handleExcelImport)
      deleteSelectedBtn.addEventListener('click', handleDeleteSelected)
      cardsEl.addEventListener('change', handleCardChange)
      cardsEl.addEventListener('click', handleCardButtonClick)
      detailCloseBtn.addEventListener('click', closeDetailModal)
      detailCancelBtn.addEventListener('click', (event) => {
        event.preventDefault()
        closeDetailModal()
      })
      detailModal.addEventListener('click', (event) => {
        if (event.target === detailModal) {
          closeDetailModal()
        }
      })
      detailForm.addEventListener('submit', handleDetailSubmit)
      detailDateInput.addEventListener('change', handleDetailDateChange)
      detailTimeSelect.addEventListener('change', handleDetailTimeChange)
      detailClearScheduleBtn.addEventListener('click', handleClearSchedule)
      if (detailValuesSelect) {
        detailValuesSelect.addEventListener('change', () =>
          enforceMultiSelectLimit(detailValuesSelect, 2),
        )
      }
      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && !detailModal.hidden) {
          closeDetailModal()
        }
      })
      if (detailBirthInput) {
        detailBirthInput.addEventListener('input', () => {
          detailBirthInput.value = detailBirthInput.value.replace(/[^0-9ë…„]/g, '')
        })
      }
      if (detailPhoneInput) {
        detailPhoneInput.addEventListener('input', () => {
          let v = detailPhoneInput.value.replace(/[^0-9]/g, '')
          if (v.length < 4) {
            detailPhoneInput.value = v
            return
          }
          if (v.length < 8) {
            detailPhoneInput.value = v.replace(/(\d{3})(\d+)/, '$1-$2')
            return
          }
          detailPhoneInput.value = v.replace(/(\d{3})(\d{3,4})(\d{0,4}).*/, '$1-$2-$3')
        })
      }
      if (detailHeightInput) {
        const formatDetailHeight = () => {
          const digits = detailHeightInput.value.replace(/[^0-9]/g, '').slice(0, 3)
          if (!digits) {
            detailHeightInput.value = ''
            return
          }
          const formatted = `${digits}cm`
          detailHeightInput.value = formatted
          if (document.activeElement === detailHeightInput) {
            const caretPos = digits.length
            requestAnimationFrame(() => {
              detailHeightInput.setSelectionRange(caretPos, caretPos)
            })
          }
        }
        detailHeightInput.addEventListener('focus', () => {
          const digits = detailHeightInput.value.replace(/[^0-9]/g, '').slice(0, 3)
          detailHeightInput.value = digits
          requestAnimationFrame(() => {
            const pos = detailHeightInput.value.length
            detailHeightInput.setSelectionRange(pos, pos)
          })
        })
        detailHeightInput.addEventListener('input', formatDetailHeight)
        detailHeightInput.addEventListener('blur', formatDetailHeight)
      }
      if (calendarScrollBtn) {
        calendarScrollBtn.addEventListener('click', () => openCalendarModal(true))
      }
      calendarCloseBtn.addEventListener('click', closeCalendarModal)
      calendarPrevBtn.addEventListener('click', () => changeCalendarMonth(-1))
      calendarNextBtn.addEventListener('click', () => changeCalendarMonth(1))
      calendarTodayBtn.addEventListener('click', () => goToToday())
      calendarModal.addEventListener('click', (event) => {
        if (event.target === calendarModal) closeCalendarModal()
      })
      calendarGrid.addEventListener('click', handleCalendarDayClick)
      calendarAppointmentList.addEventListener('click', handleCalendarAppointmentClick)
      searchInput.addEventListener('input', (event) => {
        viewState.search = event.target.value.trim()
        render()
      })
      genderFilter.addEventListener('change', (event) => {
        viewState.gender = event.target.value
        render()
      })
      heightFilter.addEventListener('change', (event) => {
        viewState.height = event.target.value
        render()
      })
      sortSelect.addEventListener('change', (event) => {
        viewState.sort = event.target.value
        render()
      })
      updateSelectionInfo()

      async function loadData() {
        try {
          const res = await fetch(API_URL)
          const body = await res.json()
          if (!body?.ok) throw new Error(body?.message || 'ë°ì´í„° ì˜¤ë¥˜')
          items = (body.data || []).map(normalizeRecord)
          syncSelectionWithItems()
          syncFilterOptions()
          updateStats()
          render()
          if (!calendarModal.hidden) {
            refreshCalendar(true)
          }
        } catch (error) {
          console.error(error)
          showToast('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')
        }
      }

      function updateStats() {
        if (!statTotalEl || !statMonthlyEl || !statWeeklyEl || !statDailyEl) return
        const now = new Date()
        const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate())
        const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1)
        const startOfWeek = new Date(startOfDay)
        const weekDay = (startOfDay.getDay() + 6) % 7
        startOfWeek.setDate(startOfDay.getDate() - weekDay)
        const total = items.length
        let monthly = 0
        let weekly = 0
        let daily = 0
        for (const item of items) {
          if (!item?.createdAt) continue
          const created = new Date(item.createdAt)
          if (Number.isNaN(created.getTime())) continue
          if (created >= startOfMonth && created <= now) monthly += 1
          if (created >= startOfWeek && created <= now) weekly += 1
          if (created >= startOfDay && created <= now) daily += 1
        }
        statTotalEl.textContent = formatLabeledCount('ì´ ìƒë‹´ ì¸ì›', total)
        statMonthlyEl.textContent = formatLabeledCount('ì›”ê°„ ìƒë‹´ ì¸ì›', monthly)
        statWeeklyEl.textContent = formatLabeledCount('ì£¼ê°„ ìƒë‹´ ì¸ì›', weekly)
        statDailyEl.textContent = formatLabeledCount('ì˜¤ëŠ˜ ìƒë‹´ ì¸ì›', daily)
      }

      function formatLabeledCount(label, value) {
        return `${label}: ${Number(value || 0).toLocaleString('ko-KR')}ëª…`
      }

      function render() {
        cardsEl.innerHTML = ''
        const prepared = getPreparedItems()
        if (!prepared.length) {
          emptyEl.hidden = false
          return
        }
        emptyEl.hidden = true
        const fragment = document.createDocumentFragment()
        prepared.forEach((item) => {
          const card = document.createElement('article')
          card.className = 'card'
          card.dataset.id = item.id || ''
          const idAttr = escapeHtml(item.id || '')
          const isSelected = selectedIds.has(item.id)
          card.innerHTML = `
              <div class="card-top">
                <div>
                  <div class="card-title">
                    <h2>${escapeHtml(item.name || 'ìµëª…')}</h2>
                    <span class="status-chip ${escapeHtml(getStatusClass(item.phoneConsultStatus))}">
                      ${escapeHtml(formatPhoneStatus(item.phoneConsultStatus))}
                    </span>
                  </div>
                  <div class="meta">${formatDate(item.createdAt)} ì ‘ìˆ˜</div>
                </div>
                <div class="card-controls">
                  <input
                    type="checkbox"
                    class="select-checkbox"
                    data-id="${idAttr}"
                    ${isSelected ? 'checked' : ''}
                    aria-label="ìƒë‹´ ì„ íƒ"
                  />
                </div>
              </div>
              <dl>
                ${renderEntry('ì—°ë½ì²˜', item.phone)}
                ${renderEntry('ì„±ë³„', item.gender)}
                ${renderEntry('ìƒë…„(ìƒì¼)', item.birth)}
                ${renderEntry('ìµœì¢…í•™ë ¥', item.education)}
                ${renderEntry('ì§ì—…', item.job)}
                ${renderEntry('ì‹ ì¥', item.height)}
                ${renderEntry('MBTI', item.mbti)}
                ${renderEntry('ì—°ë´‰', formatSalaryRange(item.salaryRange))}
                ${renderEntry('ê±°ì£¼ êµ¬', item.district)}
              </dl>
            `
          fragment.appendChild(card)
        })
        cardsEl.appendChild(fragment)
      }

      function openDetailModal(id) {
        const record = items.find((item) => item.id === id)
        if (!record) {
          showToast('ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.')
          return
        }

        detailRecordId = id
        detailTitleEl.textContent = record.name || 'ìƒë‹´ ì‹ ì²­'
        const heightLine = record.height ? `ì‹ ì¥ ${record.height}` : null
        const districtLine = record.district ? `ê±°ì£¼ êµ¬ ${record.district}` : null
        const mbtiLine = record.mbti ? `MBTI ${record.mbti}` : null
        detailSubtitleEl.textContent = [
          record.phone ? `ì—°ë½ì²˜ ${record.phone}` : null,
          record.job ? `ì§ì—… ${record.job}` : null,
          mbtiLine,
          heightLine,
          districtLine,
          record.createdAt ? `ì‹ ì²­ ${formatDate(record.createdAt)}` : null,
        ]
          .filter(Boolean)
          .join(' Â· ')

        const status = PHONE_STATUS_VALUES.includes(record.phoneConsultStatus)
          ? record.phoneConsultStatus
          : 'pending'
        detailPhoneStatusEl.value = status

        if (detailNameInput) detailNameInput.value = record.name || ''
        if (detailPhoneInput) detailPhoneInput.value = formatPhoneNumber(record.phone)
        setSelectValue(detailGenderSelect, record.gender || '')
        if (detailBirthInput) detailBirthInput.value = record.birth || ''
        if (detailHeightInput) detailHeightInput.value = normalizeHeightValue(
          record.height || record.region,
        )
        setSelectValue(detailEducationSelect, record.education || '')
        if (detailJobInput) detailJobInput.value = record.job || ''
        if (detailDistrictInput) detailDistrictInput.value = record.district || ''
        if (detailMbtiInput) detailMbtiInput.value = record.mbti || ''
        if (detailUniversityInput) detailUniversityInput.value = record.university || ''
        setSelectValue(detailSalaryRangeSelect, record.salaryRange || '')
        if (detailJobDetailInput) detailJobDetailInput.value = record.jobDetail || ''
        if (detailProfileAppealInput) detailProfileAppealInput.value = record.profileAppeal || ''
        setSelectValue(detailSmokingSelect, record.smoking || '')
        setSelectValue(detailReligionSelect, record.religion || '')
        setMultiSelectValues(detailPreferredHeightsSelect, record.preferredHeights || [])
        setMultiSelectValues(detailPreferredAgesSelect, record.preferredAges || [])
        detailValuesSelection = Array.isArray(record.values) ? record.values.slice() : []
        setMultiSelectValues(detailValuesSelect, detailValuesSelection)
        if (detailValuesCustomInput) detailValuesCustomInput.value = record.valuesCustom || ''
        if (detailSufficientConditionInput)
          detailSufficientConditionInput.value = record.sufficientCondition || ''
        if (detailNecessaryConditionInput)
          detailNecessaryConditionInput.value = record.necessaryCondition || ''
        if (detailLikesDislikesInput) detailLikesDislikesInput.value = record.likesDislikes || ''
        if (detailAboutMeInput) detailAboutMeInput.value = record.aboutMe || ''
        if (detailNotesInput) detailNotesInput.value = record.notes || ''

        const { date: scheduledDate, time: scheduledTime } = splitLocalDateTime(
          record.meetingSchedule,
        )
        detailDateInput.value = scheduledDate
        updateTimeOptions(scheduledDate, scheduledTime, id)
        detailNotesInput.value = record.notes || ''
        detailScheduleInfo.textContent = record.meetingSchedule
          ? `í˜„ì¬ ì˜ˆì•½: ${formatDate(record.meetingSchedule)}`
          : 'ëŒ€ë©´ ìƒë‹´ ì¼ì •ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.'

        detailModal.hidden = false
        document.body.classList.add('modal-open')
      }

      function closeDetailModal() {
        detailModal.hidden = true
        document.body.classList.remove('modal-open')
        detailRecordId = null
        detailForm.reset()
        detailTimeSelect.innerHTML = '<option value="">ì‹œê°„ ì„ íƒ</option>'
        detailTimeSelect.disabled = true
        detailScheduleInfo.textContent = ''
        if (detailHeightInput) detailHeightInput.value = ''
        if (detailPhoneInput) detailPhoneInput.value = ''
        if (detailMbtiInput) detailMbtiInput.value = ''
        if (detailUniversityInput) detailUniversityInput.value = ''
        setSelectValue(detailSalaryRangeSelect, '')
        if (detailJobDetailInput) detailJobDetailInput.value = ''
        if (detailProfileAppealInput) detailProfileAppealInput.value = ''
        setSelectValue(detailSmokingSelect, '')
        setSelectValue(detailReligionSelect, '')
        setMultiSelectValues(detailPreferredHeightsSelect, [])
        setMultiSelectValues(detailPreferredAgesSelect, [])
        setMultiSelectValues(detailValuesSelect, [])
        detailValuesSelection = []
        if (detailValuesCustomInput) detailValuesCustomInput.value = ''
        if (detailSufficientConditionInput) detailSufficientConditionInput.value = ''
        if (detailNecessaryConditionInput) detailNecessaryConditionInput.value = ''
        if (detailLikesDislikesInput) detailLikesDislikesInput.value = ''
        if (detailAboutMeInput) detailAboutMeInput.value = ''
      }

      function renderEntry(label, value) {
        return `
          <div>
            <dt>${label}</dt>
            <dd>${escapeHtml(value || '-')}</dd>
          </div>
        `
      }

      function normalizeHeightValue(raw) {
        const digits = String(raw || '').replace(/[^0-9]/g, '').slice(0, 3)
        return digits ? `${digits}cm` : ''
      }

      function formatPhoneNumber(raw) {
        const digits = String(raw || '').replace(/[^0-9]/g, '')
        if (!digits) return ''
        if (digits.length < 4) return digits
        if (digits.length < 8) return digits.replace(/(\d{3})(\d+)/, '$1-$2')
        return digits.replace(/(\d{3})(\d{3,4})(\d{0,4}).*/, '$1-$2-$3')
      }

      function setSelectValue(selectEl, value) {
        if (!selectEl) return
        const options = Array.from(selectEl.options || []).map((opt) => opt.value)
        selectEl.value = options.includes(value) ? value : ''
      }

      function setMultiSelectValues(selectEl, values) {
        if (!selectEl) return
        const valueSet = new Set((values || []).map((value) => String(value)))
        Array.from(selectEl.options || []).forEach((option) => {
          option.selected = valueSet.has(option.value)
        })
      }

      function getMultiSelectValues(selectEl) {
        if (!selectEl) return []
        return Array.from(selectEl.selectedOptions || [])
          .map((option) => option.value)
          .filter(Boolean)
      }

      function enforceMultiSelectLimit(selectEl, limit) {
        if (!selectEl) return
        const selected = getMultiSelectValues(selectEl)
        if (selected.length > limit) {
          setMultiSelectValues(selectEl, detailValuesSelection)
          showToast(`ê°€ì¹˜ê´€ì€ ìµœëŒ€ ${limit}ê°œê¹Œì§€ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`)
        } else {
          detailValuesSelection = selected
        }
      }

      function formatSalaryRange(value) {
        return SALARY_RANGE_LABELS[value] || ''
      }

      function formatPhoneStatus(status) {
        return PHONE_STATUS_LABELS[status] || PHONE_STATUS_LABELS.pending
      }

      function getStatusClass(status) {
        return STATUS_CLASS_NAMES[status] || STATUS_CLASS_NAMES.pending
      }

      function handleDetailDateChange() {
        const dateValue = detailDateInput.value
        updateTimeOptions(dateValue, '', detailRecordId)
        handleDetailTimeChange()
      }

      function handleDetailTimeChange() {
        const dateValue = detailDateInput.value
        const timeValue = detailTimeSelect.value
        if (dateValue && timeValue) {
          detailScheduleInfo.textContent = `ì„ íƒí•œ ì¼ì •: ${dateValue} ${timeValue}`
        } else if (dateValue && !timeValue) {
          detailScheduleInfo.textContent = 'ìƒë‹´ ì‹œê°„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.'
        }
      }

      function handleClearSchedule(event) {
        event.preventDefault()
        detailDateInput.value = ''
        updateTimeOptions('', '', detailRecordId)
        detailScheduleInfo.textContent = 'ëŒ€ë©´ ìƒë‹´ ì¼ì •ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.'
      }

      async function handleDetailSubmit(event) {
        event.preventDefault()
        if (!detailRecordId) {
          showToast('ëŒ€ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')
          return
        }

        const phoneStatus = detailPhoneStatusEl.value
        if (!PHONE_STATUS_VALUES.includes(phoneStatus)) {
          showToast('ì „í™” ìƒë‹´ ìƒíƒœë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.')
          return
        }

        if (!detailForm.reportValidity()) {
          return
        }

        const nameValue = (detailNameInput?.value || '').trim()
        if (detailNameInput) detailNameInput.value = nameValue
        const phoneValue = formatPhoneNumber(detailPhoneInput?.value)
        if (detailPhoneInput) detailPhoneInput.value = phoneValue
        const genderValue = detailGenderSelect?.value || ''
        const birthValue = (detailBirthInput?.value || '').trim()
        if (detailBirthInput) detailBirthInput.value = birthValue
        const educationValue = detailEducationSelect?.value || ''
        const jobValue = (detailJobInput?.value || '').trim()
        if (detailJobInput) detailJobInput.value = jobValue
        const districtValue = (detailDistrictInput?.value || '').trim()
        if (detailDistrictInput) detailDistrictInput.value = districtValue
        const heightValue = normalizeHeightValue(detailHeightInput?.value)
        if (detailHeightInput) detailHeightInput.value = heightValue
        const mbtiValue = (detailMbtiInput?.value || '').trim()
        if (detailMbtiInput) detailMbtiInput.value = mbtiValue
        const universityValue = (detailUniversityInput?.value || '').trim()
        if (detailUniversityInput) detailUniversityInput.value = universityValue
        const salaryRangeValue = detailSalaryRangeSelect?.value || ''
        setSelectValue(detailSalaryRangeSelect, salaryRangeValue)
        const jobDetailValue = (detailJobDetailInput?.value || '').trim()
        if (detailJobDetailInput) detailJobDetailInput.value = jobDetailValue
        const profileAppealValue = (detailProfileAppealInput?.value || '').trim()
        if (detailProfileAppealInput) detailProfileAppealInput.value = profileAppealValue
        const smokingValue = detailSmokingSelect?.value || ''
        setSelectValue(detailSmokingSelect, smokingValue)
        const religionValue = detailReligionSelect?.value || ''
        setSelectValue(detailReligionSelect, religionValue)
        const preferredHeights = getMultiSelectValues(detailPreferredHeightsSelect)
        const preferredAges = getMultiSelectValues(detailPreferredAgesSelect)
        const valuesSelected = getMultiSelectValues(detailValuesSelect)
        if (valuesSelected.length > 2) {
          showToast('ê°€ì¹˜ê´€ì€ ìµœëŒ€ 2ê°œê¹Œì§€ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.')
          return
        }
        detailValuesSelection = valuesSelected
        const valuesCustomValue = (detailValuesCustomInput?.value || '').trim()
        if (detailValuesCustomInput) detailValuesCustomInput.value = valuesCustomValue
        const sufficientConditionValue = (detailSufficientConditionInput?.value || '').trim()
        if (detailSufficientConditionInput)
          detailSufficientConditionInput.value = sufficientConditionValue
        const necessaryConditionValue = (detailNecessaryConditionInput?.value || '').trim()
        if (detailNecessaryConditionInput)
          detailNecessaryConditionInput.value = necessaryConditionValue
        const likesDislikesValue = (detailLikesDislikesInput?.value || '').trim()
        if (detailLikesDislikesInput) detailLikesDislikesInput.value = likesDislikesValue
        const aboutMeValue = (detailAboutMeInput?.value || '').trim()
        if (detailAboutMeInput) detailAboutMeInput.value = aboutMeValue

        const dateValue = detailDateInput.value
        const timeValue = detailTimeSelect.disabled ? '' : detailTimeSelect.value

        if (dateValue && !timeValue) {
          showToast('ìƒë‹´ ì‹œê°„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.')
          return
        }
        if (!dateValue && timeValue) {
          showToast('ìƒë‹´ ë‚ ì§œë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.')
          return
        }

        let meetingSchedule = ''
        if (dateValue && timeValue) {
          const date = new Date(`${dateValue}T${timeValue}`)
          if (Number.isNaN(date.getTime())) {
            showToast('ìœ íš¨í•œ ìƒë‹´ ì¼ì •ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.')
            return
          }
          meetingSchedule = date.toISOString()
        }

        const payload = {
          name: nameValue,
          gender: genderValue,
          phone: phoneValue,
          birth: birthValue,
          education: educationValue,
          job: jobValue,
          height: heightValue,
          district: districtValue,
          mbti: mbtiValue,
          university: universityValue,
          salaryRange: salaryRangeValue,
          jobDetail: jobDetailValue,
          profileAppeal: profileAppealValue,
          smoking: smokingValue,
          religion: religionValue,
          preferredHeights,
          preferredAges,
          sufficientCondition: sufficientConditionValue,
          necessaryCondition: necessaryConditionValue,
          likesDislikes: likesDislikesValue,
          values: valuesSelected,
          valuesCustom: valuesCustomValue,
          aboutMe: aboutMeValue,
          phoneConsultStatus: phoneStatus,
          meetingSchedule,
          notes: detailNotesInput.value?.trim() || '',
        }

        suppressUpdateToast = true
        try {
          const res = await fetch(`${API_URL}/${detailRecordId}`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
          })
          const body = await res.json().catch(() => ({}))
          if (!res.ok || !body?.ok) {
            throw new Error(body?.message || 'ìƒì„¸ ì •ë³´ë¥¼ ì €ì¥í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.')
          }

          const updated = normalizeRecord(body.data)
          if (updated?.id) {
            const index = items.findIndex((item) => item.id === updated.id)
            if (index !== -1) {
              items[index] = updated
            } else {
              items.push(updated)
            }
          }
          syncFilterOptions()
          syncSelectionWithItems()
          updateStats()
          render()
          if (!calendarModal.hidden) {
            refreshCalendar(true)
          }
          showToast('ìƒì„¸ ì •ë³´ë¥¼ ì €ì¥í–ˆìŠµë‹ˆë‹¤.')
          closeDetailModal()
        } catch (error) {
          suppressUpdateToast = false
          console.error(error)
          showToast(error.message || 'ìƒì„¸ ì •ë³´ë¥¼ ì €ì¥í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.')
        } finally {
          setTimeout(() => {
            suppressUpdateToast = false
          }, 1000)
        }
      }

      function updateTimeOptions(dateValue, selectedTime, currentId) {
        detailTimeSelect.innerHTML = '<option value="">ì‹œê°„ ì„ íƒ</option>'
        if (!dateValue) {
          detailTimeSelect.disabled = true
          detailScheduleInfo.textContent = 'ëŒ€ë©´ ìƒë‹´ ì¼ì •ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.'
          return
        }

        const reserved = getReservedTimes(dateValue, currentId)
        let hasAvailable = false
        generateTimeSlots().forEach((slot) => {
          const option = document.createElement('option')
          option.value = slot
          option.textContent = slot
          if (reserved.has(slot) && slot !== selectedTime) {
            option.disabled = true
            option.textContent = `${slot} (ì˜ˆì•½ë¨)`
          } else {
            hasAvailable = true
          }
          detailTimeSelect.appendChild(option)
        })

        detailTimeSelect.disabled = false
        if (selectedTime) {
          detailTimeSelect.value = selectedTime
        } else {
          detailTimeSelect.value = ''
        }

        if (!hasAvailable && !selectedTime) {
          detailScheduleInfo.textContent = 'ì„ íƒí•œ ë‚ ì§œì—ëŠ” ì˜ˆì•½ ê°€ëŠ¥í•œ ì‹œê°„ì´ ì—†ìŠµë‹ˆë‹¤.'
        } else if (!selectedTime) {
          detailScheduleInfo.textContent =
            'ì˜ˆì•½ëœ ì‹œê°„ì€ ìë™ìœ¼ë¡œ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.'
        }
      }

      function generateTimeSlots() {
        const slots = []
        for (let hour = TIME_SLOT_START_HOUR; hour <= TIME_SLOT_END_HOUR; hour += 1) {
          for (let minute = 0; minute < 60; minute += TIME_SLOT_INTERVAL_MINUTES) {
            if (hour === TIME_SLOT_END_HOUR && minute > 0) break
            const h = String(hour).padStart(2, '0')
            const m = String(minute).padStart(2, '0')
            slots.push(`${h}:${m}`)
          }
        }
        return slots
      }

      function getReservedTimes(dateValue, currentId) {
        const reserved = new Set()
        if (!dateValue) return reserved

        items.forEach((item) => {
          if (!item.meetingSchedule || item.id === currentId) return
          const { date, time } = splitLocalDateTime(item.meetingSchedule)
          if (date === dateValue && time) {
            reserved.add(time)
          }
        })
        return reserved
      }

      function openCalendarModal(forceRefresh = false) {
        calendarModal.hidden = false
        document.body.classList.add('modal-open')
        refreshCalendar(forceRefresh)
      }

      function closeCalendarModal() {
        calendarModal.hidden = true
        document.body.classList.remove('modal-open')
      }

      function refreshCalendar(forceSelection = false) {
        const meetings = getMeetingsGroupedByDate()
        const todayKey = getDateKey(new Date())

        if (
          !calendarState.selectedDate ||
          forceSelection ||
          (calendarState.selectedDate && !meetings.has(calendarState.selectedDate))
        ) {
          if (meetings.has(todayKey)) {
            calendarState.selectedDate = todayKey
          } else if (meetings.size) {
            const earliest = Array.from(meetings.keys()).sort()[0]
            calendarState.selectedDate = earliest
          } else {
            calendarState.selectedDate = todayKey
          }
        }

        const selectedDateObj = new Date(calendarState.selectedDate)
        if (!Number.isNaN(selectedDateObj.getTime())) {
          calendarState.current = new Date(
            selectedDateObj.getFullYear(),
            selectedDateObj.getMonth(),
            1,
          )
        }

        renderCalendar(meetings)
        renderCalendarAppointments(meetings)
      }

      function changeCalendarMonth(offset) {
        calendarState.current = new Date(
          calendarState.current.getFullYear(),
          calendarState.current.getMonth() + offset,
          1,
        )
        const meetings = getMeetingsGroupedByDate()
        const year = calendarState.current.getFullYear()
        const month = String(calendarState.current.getMonth() + 1).padStart(2, '0')
        const monthDates = Array.from(meetings.keys())
          .filter((key) => key.startsWith(`${year}-${month}-`))
          .sort()

        if (monthDates.length) {
          calendarState.selectedDate = monthDates[0]
        } else {
          calendarState.selectedDate = getDateKey(
            new Date(calendarState.current.getFullYear(), calendarState.current.getMonth(), 1),
          )
        }

        renderCalendar(meetings)
        renderCalendarAppointments(meetings)
      }

      function goToToday() {
        const today = new Date()
        calendarState.current = new Date(today.getFullYear(), today.getMonth(), 1)
        calendarState.selectedDate = getDateKey(today)
        refreshCalendar(true)
      }

      function handleCalendarDayClick(event) {
        const dayEl = event.target.closest('.calendar-day')
        if (!dayEl || !dayEl.dataset.date) return
        calendarState.selectedDate = dayEl.dataset.date
        const dateObj = new Date(calendarState.selectedDate)
        if (!Number.isNaN(dateObj.getTime())) {
          calendarState.current = new Date(dateObj.getFullYear(), dateObj.getMonth(), 1)
        }
        const meetings = getMeetingsGroupedByDate()
        renderCalendar(meetings)
        renderCalendarAppointments(meetings)
      }

      function handleCalendarAppointmentClick(event) {
        const itemEl = event.target.closest('li[data-id]')
        if (!itemEl || itemEl.classList.contains('calendar-empty-item')) return
        const { id } = itemEl.dataset
        if (id) openDetailModal(id)
      }

      function renderCalendar(meetingsMap) {
        const year = calendarState.current.getFullYear()
        const month = calendarState.current.getMonth()
        calendarCurrentMonthEl.textContent = `${year}ë…„ ${month + 1}ì›”`

        calendarGrid.innerHTML = ''
        const fragment = document.createDocumentFragment()
        const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ']
        weekdays.forEach((label) => {
          const cell = document.createElement('div')
          cell.className = 'calendar-weekday'
          cell.textContent = label
          fragment.appendChild(cell)
        })

        const firstDay = new Date(year, month, 1)
        const startDate = new Date(firstDay)
        startDate.setDate(firstDay.getDate() - firstDay.getDay())

        const todayKey = getDateKey(new Date())

        for (let i = 0; i < 42; i += 1) {
          const date = new Date(startDate)
          date.setDate(startDate.getDate() + i)
          const dateKey = getDateKey(date)
          const dayCell = document.createElement('div')
          dayCell.className = 'calendar-day'
          dayCell.dataset.date = dateKey

          if (date.getMonth() !== month) dayCell.classList.add('other-month')
          if (dateKey === todayKey) dayCell.classList.add('today')
          if (dateKey === calendarState.selectedDate) dayCell.classList.add('selected')

          const events = meetingsMap.get(dateKey) || []
          if (events.length) dayCell.classList.add('has-events')

          const dayNumber = document.createElement('div')
          dayNumber.className = 'day-number'
          dayNumber.textContent = date.getDate()

          const dayCount = document.createElement('div')
          dayCount.className = 'day-count'
          dayCount.textContent = events.length ? `${events.length}ê±´` : ''

          dayCell.appendChild(dayNumber)
          dayCell.appendChild(dayCount)
          fragment.appendChild(dayCell)
        }

        calendarGrid.appendChild(fragment)
      }

      function renderCalendarAppointments(meetingsMap) {
        const dateKey = calendarState.selectedDate
        calendarSelectedTitleEl.textContent = formatSelectedDateTitle(dateKey)
        calendarAppointmentList.innerHTML = ''

        const meetings = meetingsMap.get(dateKey) || []
        if (!meetings.length) {
          const emptyItem = document.createElement('li')
          emptyItem.className = 'calendar-empty-item'
          emptyItem.textContent = 'ì˜ˆì•½ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.'
          calendarAppointmentList.appendChild(emptyItem)
          return
        }

        meetings
          .map((entry) => ({
            ...entry,
            displaySchedule: formatCalendarSchedule(entry.record.meetingSchedule, entry.time, dateKey),
          }))
          .sort((a, b) => a.displaySchedule.localeCompare(b.displaySchedule))
          .forEach((entry) => {
            const li = document.createElement('li')
            li.dataset.id = entry.id

            const phoneLine = escapeHtml(entry.record.phone || '-')
            const heightLine = entry.record.height
              ? `<span class="meta-line">ì‹ ì¥ ${escapeHtml(entry.record.height)}</span>`
              : ''
            const districtLine = entry.record.district
              ? `<span class="meta-line">ê±°ì£¼ êµ¬ ${escapeHtml(entry.record.district)}</span>`
              : ''
            const jobLine = entry.record.job
              ? `<span class="meta-line">ì§ì—… ${escapeHtml(entry.record.job)}</span>`
              : ''

            li.innerHTML = `
            <time>${entry.displaySchedule}</time>
            <span>${escapeHtml(entry.name || 'ìµëª…')} Â· ${formatPhoneStatus(entry.record.phoneConsultStatus)}</span>
            <span class="meta-line">ì—°ë½ì²˜ ${phoneLine}</span>
            ${heightLine}
            ${districtLine}
            ${jobLine}
          `
            if (entry.record.notes) {
              const noteSpan = document.createElement('span')
              noteSpan.className = 'note-line'
              noteSpan.textContent = entry.record.notes
              li.appendChild(noteSpan)
            }
            calendarAppointmentList.appendChild(li)
          })
      }

      function formatCalendarSchedule(schedule, fallbackTime, fallbackDateKey) {
        if (schedule) {
          const date = new Date(schedule)
          if (!Number.isNaN(date.getTime())) {
            const time = `${String(date.getHours()).padStart(2, '0')}:${String(
              date.getMinutes(),
            ).padStart(2, '0')}`
            return `${String(date.getFullYear())}ë…„ ${String(date.getMonth() + 1)}ì›” ${String(
              date.getDate(),
            )}ì¼ ${time}`
          }
        }
        return `${fallbackDateKey} ${fallbackTime}`
      }

      function getMeetingsGroupedByDate() {
        const map = new Map()
        items.forEach((item) => {
          if (!item.meetingSchedule) return
          const { date, time } = splitLocalDateTime(item.meetingSchedule)
          if (!date || !time) return
          if (!map.has(date)) {
            map.set(date, [])
          }
          map.get(date).push({
            id: item.id,
            name: item.name,
            time,
            record: item,
          })
        })

        map.forEach((list, key) => list.sort((a, b) => a.time.localeCompare(b.time)))
        return map
      }

      function getDateKey(date) {
        const year = date.getFullYear()
        const month = String(date.getMonth() + 1).padStart(2, '0')
        const day = String(date.getDate()).padStart(2, '0')
        return `${year}-${month}-${day}`
      }

      function formatSelectedDateTitle(dateKey) {
        if (!dateKey) return 'ì„ íƒëœ ì¼ì •'
        const [year, month, day] = dateKey.split('-').map((value) => Number(value))
        if ([year, month, day].some((value) => Number.isNaN(value))) return 'ì„ íƒëœ ì¼ì •'
        return `${year}ë…„ ${month}ì›” ${day}ì¼ ì¼ì •`
      }


      function normalizeRecord(record) {
        if (!record || typeof record !== 'object') return record
        const normalized = { ...record }
        if (!PHONE_STATUS_VALUES.includes(normalized.phoneConsultStatus)) {
          normalized.phoneConsultStatus = 'pending'
        }
        if (typeof normalized.meetingSchedule !== 'string') {
          normalized.meetingSchedule = ''
        }
        if (typeof normalized.notes !== 'string') {
          normalized.notes = ''
        }
        if (typeof normalized.job !== 'string') {
          normalized.job = normalized.job != null ? String(normalized.job) : ''
        }
        if (typeof normalized.height !== 'string') {
          normalized.height = normalized.height != null ? String(normalized.height) : ''
        }
        normalized.height = normalizeHeightValue(normalized.height)
        if (typeof normalized.district !== 'string') {
          normalized.district = normalized.district != null ? String(normalized.district) : ''
        }
        normalized.mbti = normalized.mbti != null ? String(normalized.mbti) : ''
        normalized.university = normalized.university != null ? String(normalized.university) : ''
        normalized.salaryRange = normalized.salaryRange != null ? String(normalized.salaryRange) : ''
        normalized.jobDetail = normalized.jobDetail != null ? String(normalized.jobDetail) : ''
        normalized.profileAppeal =
          normalized.profileAppeal != null ? String(normalized.profileAppeal) : ''
        normalized.smoking = normalized.smoking != null ? String(normalized.smoking) : ''
        normalized.religion = normalized.religion != null ? String(normalized.religion) : ''
        normalized.sufficientCondition =
          normalized.sufficientCondition != null ? String(normalized.sufficientCondition) : ''
        normalized.necessaryCondition =
          normalized.necessaryCondition != null ? String(normalized.necessaryCondition) : ''
        normalized.likesDislikes =
          normalized.likesDislikes != null ? String(normalized.likesDislikes) : ''
        normalized.valuesCustom = normalized.valuesCustom != null ? String(normalized.valuesCustom) : ''
        normalized.aboutMe = normalized.aboutMe != null ? String(normalized.aboutMe) : ''
        normalized.preferredHeights = Array.isArray(normalized.preferredHeights)
          ? normalized.preferredHeights.map((value) => String(value))
          : []
        normalized.preferredAges = Array.isArray(normalized.preferredAges)
          ? normalized.preferredAges.map((value) => String(value))
          : []
        normalized.values = Array.isArray(normalized.values)
          ? normalized.values.map((value) => String(value))
          : []
        normalized.agreements =
          normalized.agreements && typeof normalized.agreements === 'object'
            ? {
                info: Boolean(normalized.agreements.info),
                manners: Boolean(normalized.agreements.manners),
              }
            : { info: false, manners: false }
        return normalized
      }

      function splitLocalDateTime(value) {
        if (!value) return { date: '', time: '' }
        const date = new Date(value)
        if (Number.isNaN(date.getTime())) return { date: '', time: '' }
        const year = date.getFullYear()
        const month = String(date.getMonth() + 1).padStart(2, '0')
        const day = String(date.getDate()).padStart(2, '0')
        const hours = String(date.getHours()).padStart(2, '0')
        const minutes = String(date.getMinutes()).padStart(2, '0')
        return {
          date: `${year}-${month}-${day}`,
          time: `${hours}:${minutes}`,
        }
      }

      function getPreparedItems() {
        let result = items.slice()
        if (viewState.search) {
          const term = viewState.search.toLowerCase()
          result = result.filter((item) =>
            [
              'name',
              'phone',
              'height',
              'district',
              'education',
              'job',
              'mbti',
              'university',
              'salaryRange',
              'jobDetail',
              'profileAppeal',
              'likesDislikes',
              'aboutMe',
              'valuesCustom',
              'sufficientCondition',
              'necessaryCondition',
            ]
              .map((key) => String(item[key] || '').toLowerCase())
              .some((value) => value.includes(term))
          )
        }
        if (viewState.gender !== 'all') {
          result = result.filter((item) => (item.gender || '') === viewState.gender)
        }
        if (viewState.height !== 'all') {
          result = result.filter((item) => (item.height || '') === viewState.height)
        }

        switch (viewState.sort) {
          case 'oldest':
            result.sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt))
            break
          case 'name':
            result.sort((a, b) =>
              String(a.name || '').localeCompare(String(b.name || ''), 'ko-KR')
            )
            break
          case 'height':
            result.sort((a, b) =>
              String(a.height || '').localeCompare(String(b.height || ''), 'ko-KR')
            )
            break
          case 'latest':
          default:
            result.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
            break
        }

        return result
      }

      function syncFilterOptions() {
        populateSelect(
          genderFilter,
          uniqueSorted(items.map((item) => item.gender)),
          'ì„±ë³„ ì „ì²´'
        )
        populateSelect(
          heightFilter,
          uniqueSorted(items.map((item) => item.height)),
          'ì‹ ì¥ ì „ì²´'
        )
      }

      function populateSelect(selectEl, values, placeholder) {
        const previous = selectEl.value || 'all'
        selectEl.innerHTML = ''
        const fragment = document.createDocumentFragment()
        const allOption = document.createElement('option')
        allOption.value = 'all'
        allOption.textContent = placeholder
        fragment.appendChild(allOption)
        values
          .filter(Boolean)
          .forEach((value) => {
            const option = document.createElement('option')
            option.value = value
            option.textContent = value
            fragment.appendChild(option)
          })
        selectEl.appendChild(fragment)
        if (values.includes(previous)) {
          selectEl.value = previous
        } else {
          selectEl.value = 'all'
        }
        if (selectEl === genderFilter) {
          viewState.gender = selectEl.value
        }
        if (selectEl === heightFilter) {
          viewState.height = selectEl.value
        }
      }

      function uniqueSorted(values) {
        return Array.from(
          new Set(values.filter((value) => value && value.trim()))
        ).sort((a, b) => a.localeCompare(b, 'ko-KR'))
      }

      function syncSelectionWithItems() {
        const validIds = new Set(items.map((item) => item.id))
        Array.from(selectedIds).forEach((id) => {
          if (!validIds.has(id)) selectedIds.delete(id)
        })
        updateSelectionInfo()
      }

      function updateSelectionInfo() {
        const count = selectedIds.size
        selectionInfoEl.textContent = count ? `${count}ê±´ ì„ íƒë¨` : ''
        bulkActionBar.hidden = count === 0
        deleteSelectedBtn.disabled = count === 0
      }

      function formatDate(value) {
        if (!value) return '-'
        try {
          return new Date(value).toLocaleString('ko-KR')
        } catch (error) {
          return value
        }
      }

      function escapeHtml(str) {
        return String(str || '')
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;')
      }

      function showToast(message) {
        toastEl.textContent = message
        toastEl.classList.add('show')
        setTimeout(() => toastEl.classList.remove('show'), 2500)
      }

      function handleCardChange(event) {
        const target = event.target
        if (!target.classList.contains('select-checkbox')) return
        const id = target.dataset.id
        if (!id) return
        if (target.checked) {
          selectedIds.add(id)
        } else {
          selectedIds.delete(id)
        }
        updateSelectionInfo()
      }

      function handleCardButtonClick(event) {
        const card = event.target.closest('.card')
        if (!card) return
        const checkbox = event.target.closest('.select-checkbox')
        if (checkbox) return
        const { id } = card.dataset
        if (id) openDetailModal(id)
      }

      function handleDeleteSelected() {
        if (!selectedIds.size) return
        if (!confirm('ì„ íƒí•œ ìƒë‹´ì„ ì‚­ì œí• ê¹Œìš”?')) return
        deleteRecords(Array.from(selectedIds))
      }

      async function deleteRecords(ids) {
        const unique = Array.from(new Set((ids || []).filter(Boolean)))
        if (!unique.length) return
        suppressDeleteToast = true
        try {
          const res = await fetch(API_URL, {
            method: 'DELETE',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ ids: unique }),
          })
          const body = await res.json().catch(() => ({}))
          if (!res.ok || !body?.ok) {
            throw new Error(body?.message || 'ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')
          }
          const idSet = new Set(unique)
          items = items.filter((item) => !idSet.has(item.id))
          unique.forEach((id) => selectedIds.delete(id))
          syncSelectionWithItems()
          syncFilterOptions()
          updateStats()
          render()
          if (!calendarModal.hidden) {
            refreshCalendar(true)
          }
          showToast(`${body.count ?? unique.length}ê±´ì„ ì‚­ì œí–ˆìŠµë‹ˆë‹¤.`)
        } catch (error) {
          suppressDeleteToast = false
          console.error(error)
          showToast(error.message || 'ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')
        } finally {
          setTimeout(() => {
            suppressDeleteToast = false
          }, 2000)
        }
      }

      function setupSSE() {
        if (!('EventSource' in window)) return
        const source = new EventSource(EVENTS_URL)
        source.addEventListener('message', (event) => {
          if (!event?.data) return
          try {
            const payload = JSON.parse(event.data)
            if (payload?.type === 'consult:new') {
              items.push(normalizeRecord(payload.payload))
              syncFilterOptions()
              syncSelectionWithItems()
              updateStats()
              render()
              if (!calendarModal.hidden) refreshCalendar(true)
              showToast('ìƒˆë¡œìš´ ìƒë‹´ ì‹ ì²­ì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤!')
            } else if (payload?.type === 'consult:import') {
              items = Array.isArray(payload.payload)
                ? payload.payload.map(normalizeRecord)
                : []
              selectedIds.clear()
              syncSelectionWithItems()
              syncFilterOptions()
              updateStats()
              render()
              if (!calendarModal.hidden) refreshCalendar(true)
              showToast('ì—‘ì…€ ë°ì´í„°ê°€ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤.')
            } else if (payload?.type === 'consult:update') {
              const updated = normalizeRecord(payload.payload)
              if (updated?.id) {
                const index = items.findIndex((item) => item.id === updated.id)
                if (index !== -1) {
                  items[index] = updated
                } else {
                  items.push(updated)
                }
              }
              syncSelectionWithItems()
              syncFilterOptions()
              updateStats()
              render()
              if (!calendarModal.hidden) refreshCalendar(true)
              if (suppressUpdateToast) {
                suppressUpdateToast = false
              } else if (updated?.name) {
                showToast(`${updated.name} ë‹˜ì˜ ì •ë³´ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.`)
              }
            } else if (payload?.type === 'consult:delete') {
              const ids = Array.isArray(payload.payload?.ids) ? payload.payload.ids : []
              if (!ids.length) return
              const idSet = new Set(ids)
              const before = items.length
              items = items.filter((item) => !idSet.has(item.id))
              ids.forEach((id) => selectedIds.delete(id))
              syncSelectionWithItems()
              syncFilterOptions()
              updateStats()
              render()
              if (!calendarModal.hidden) refreshCalendar(true)
              if (suppressDeleteToast) {
                suppressDeleteToast = false
              } else if (before !== items.length) {
                showToast(`${ids.length}ê±´ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`)
              }
            }
          } catch (error) {
            console.error(error)
          }
        })
        source.addEventListener('error', () => {
          showToast('ì‹¤ì‹œê°„ ì—°ê²°ì´ ëŠê²¼ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ìë™ ì¬ì—°ê²°í•©ë‹ˆë‹¤.')
        })
      }

      function exportToExcel() {
        const prepared = getPreparedItems()
        if (!prepared.length) {
          showToast('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.')
          return
        }
        if (typeof XLSX === 'undefined') {
          showToast('ì—‘ì…€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')
          return
        }
        const rows = prepared.map((item, index) => ({
          ë²ˆí˜¸: index + 1,
          ì„±ëª…: item.name || '',
          ì„±ë³„: item.gender || '',
          ì—°ë½ì²˜: item.phone || '',
          ìƒë…„ì›”ì¼: item.birth || '',
          ìµœì¢…í•™ë ¥: item.education || '',
          ì§ì—…: item.job || '',
          ì‹ ì¥: item.height || '',
          MBTI: item.mbti || '',
          ëŒ€í•™êµ: item.university || '',
          ì—°ë´‰êµ¬ê°„: formatSalaryRange(item.salaryRange) || '',
          í¡ì—°: item.smoking || '',
          ì¢…êµ: item.religion || '',
          ì„ í˜¸í‚¤: (item.preferredHeights || []).join(', '),
          ì„ í˜¸ë‚˜ì´: (item.preferredAges || []).join(', '),
          ê±°ì£¼êµ¬: item.district || '',
          ì§ë¬´ìƒì„¸: item.jobDetail || '',
          ì¶”ê°€ì–´í•„: item.profileAppeal || '',
          ì¶©ë¶„ì¡°ê±´: item.sufficientCondition || '',
          í•„ìš”ì¡°ê±´: item.necessaryCondition || '',
          ì¢‹ì•„í•˜ëŠ”ê²ƒì‹«ì–´í•˜ëŠ”ê²ƒ: item.likesDislikes || '',
          ê°€ì¹˜ê´€: (item.values || []).join(', '),
          ê°€ì¹˜ê´€ê¸°íƒ€: item.valuesCustom || '',
          ìê¸°ì†Œê°œ: item.aboutMe || '',
          ì ‘ìˆ˜ì‹œê°„: formatDate(item.createdAt),
        }))
        const worksheet = XLSX.utils.json_to_sheet(rows)
        const workbook = XLSX.utils.book_new()
        XLSX.utils.book_append_sheet(workbook, worksheet, 'ìƒë‹´ ì‹ ì²­')
        const dateLabel = new Date().toISOString().slice(0, 10)
        XLSX.writeFile(workbook, `consultations-${dateLabel}.xlsx`)
        showToast('ì—‘ì…€ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.')
      }

      async function handleExcelImport(event) {
        const file = event.target.files?.[0]
        if (!file) return
        if (typeof XLSX === 'undefined') {
          showToast('ì—‘ì…€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')
          return
        }

        try {
          const data = await file.arrayBuffer()
          const workbook = XLSX.read(data, { type: 'array' })
          const sheetName = workbook.SheetNames[0]
          if (!sheetName) {
            showToast('ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')
            return
          }

          const sheet = workbook.Sheets[sheetName]
          const json = XLSX.utils.sheet_to_json(sheet, { defval: '' })
          if (!json.length) {
            showToast('ì—‘ì…€ì—ì„œ ë°ì´í„°ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.')
            return
          }

          const normalized = json.map((row) => ({
            id: row.id || row.ID || row.Id || String(Math.random()).slice(2),
            name: row.ì„±ëª… || row.ì´ë¦„ || row.name || '',
            gender: row.ì„±ë³„ || row.gender || '',
            phone: row.ì—°ë½ì²˜ || row.phone || '',
            birth: row.ìƒë…„ì›”ì¼ || row.birth || '',
            job: row.ì§ì—… || row.job || row.occupation || '',
            height:
              row.ì‹ ì¥ ||
              row['ì‹ ì¥(cm)'] ||
              row.height ||
              row.ê±°ì£¼ì§€ì—­ ||
              row.ì§€ì—­ ||
              row.region ||
              '',
            district: row.ê±°ì£¼êµ¬ || row['ê±°ì£¼ êµ¬'] || row.êµ¬ || row.district || '',
            education: row.ìµœì¢…í•™ë ¥ || row.education || '',
            createdAt: row.ì ‘ìˆ˜ì‹œê°„
              ? new Date(row.ì ‘ìˆ˜ì‹œê°„).toISOString()
              : row.createdAt || new Date().toISOString(),
          }))

        const response = await fetch(API_IMPORT_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ items: normalized }),
          })

          const body = await response.json()
          if (!response.ok || !body?.ok) {
            throw new Error(body?.message || 'ì—‘ì…€ ë°ì´í„°ë¥¼ ë°˜ì˜í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.')
          }

          showToast(`ì—‘ì…€ ë°ì´í„° ${normalized.length}ê±´ì„ ë°˜ì˜í–ˆìŠµë‹ˆë‹¤.`)
          selectedIds.clear()
          updateSelectionInfo()
          excelInput.value = ''
          await loadData()
        } catch (error) {
          console.error(error)
          showToast(error.message || 'ì—‘ì…€ íŒŒì¼ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')
        } finally {
          excelInput.value = ''
        }
      }
      if (!authForm) {
        if (appContentEl) appContentEl.hidden = false
        document.body.classList.remove('auth-locked')
        initializeApp()
      }
    </script>
    <div class="sticky-note">[ì•„ì„ì›¹ ì•„ì´ë”” ë¹„ë²ˆ ë¹„ë°€ë²ˆí˜¸] <br>
ID: yeongyeolsa@gmail.com <br>
PS: 10Aksghldnjs!
<br><br>
[êµ¬ê¸€ ì•„ì´ë”” ë¹„ë²ˆ ë¹„ë°€ë²ˆí˜¸] <br>
ID: yeongyeolsa@gmail.com <br>
PS: 10aksghldnjs</div>
    </div>
  </body>
</html>

